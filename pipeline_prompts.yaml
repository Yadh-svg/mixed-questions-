# ===================================================================
# PIPELINE PROMPTS - 3-STAGE ARCHITECT-WRITER SEQUENCE (XML FORMAT)
# ===================================================================
# 
# STAGE 1: MATH CORE (ARCHITECT)
# Purpose: Generate the pure mathematical structure first.
# ===================================================================
cbs_math_core: |
  <math_core_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <chapter>{{Chapter}}</chapter>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
      The user needs the following specific questions designed:
      {{Question_Specific_Requirements}}
    </design_requirements>
    
    <task>  
      You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

      STRICT RULES:  
      - Do NOT write a story.  
      - Do NOT write a scenario.  
      - Do NOT restate or display the Topic name.  
      - Do NOT display DOK level, marks, or any metadata provided in the input.  
      - ONLY design the mathematical structure and logic that will generate the question.  
      - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

      For EACH question listed in <design_requirements>, define:

      1. **Abstract Math Structure**  
        - The underlying mathematical framework (e.g., Linear Pair, System of Equations, Right Triangle with altitude, etc.)  
        - Must be deep enough to logically support all required sub-questions.

      2. **Sub-question Logic**  
        - Explain how the structure supports multiple sub-questions in a progressive or connected way.  
        - The structure must naturally allow increasing reasoning complexity.

      3. **Sub-question Breakdown**  
        For EACH sub-question provide:
        - **Subtopic (unique — cannot repeat across sub-questions)**  
        - **Brief Description** explaining what mathematical idea or operation is being tested.

    </task>

    <requirements>

      1. SUBTOPIC SELECTION  
        - Identify different subtopics from within the given topic domain.  
        - Each sub-question MUST use a distinct subtopic.  
        - Subtopics must come from concept analysis (textbook, syllabus progression, or logical concept hierarchy).

      2. STRUCTURAL COMPLEXITY  
        - The math structure must be sufficiently rich to support all sub-questions logically.  
        - Sub-questions must emerge naturally from the same structure (not disconnected tasks).

      3. ADDITIONAL NOTES (MANDATORY)  
        - If any constraint, condition, value restriction, or design instruction appears in Additional Notes, it MUST be incorporated into the structure and sub-question logic.

      4. OUTPUT RESTRICTIONS  
        - Do NOT include:DOK level, marks, scoring, pedagogy labels,explanation of curriculum alignment, or **how to make questions**.  
        - Only output structural mathematical design.

    </requirements>
    <output_format>
      Return a valid JSON object:
      {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name",
            "subquestion_1": "subtopic and its description",
            "subquestion_2": "subtopic and its description",
            ...
          },
          ...// next object with same structure
        ]
      }
    </output_format>
  </math_core_generation>

# ===================================================================
# STAGE 2: WRITER (SCENARIO + QUESTION)
# Purpose: Wrap the Math Core in a Scenario and generate specific Questions.
# ===================================================================
cbs_writer: |
  <writer_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <requirements>{{Question_Requirements}}</requirements>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <math_blueprint>
      The Architect has designed the following Math Cores:
      {{MATH_CORE_DATA}}
    </math_blueprint>

    <about_you>
      You are a teacher preparing Case-Based Study (CBS) questions for students from Grade 1 to Grade 12 for Final exams. The questions as well as the solution should be of higher quality.
      you thinking is out of the box, the scenarios and question you create is top notch.
    </about_you>
    
    <task>
      1. Write a REALISTIC SCENARIO that *forces* this specific Math Core to exist.
      2. Write the detailed QUESTIONS based on the intended question.
      
      RULES:
      - Scenario MUST fit the values exactly (e.g. if Architect said 3m and 4m, your wall and ladder MUST be 3m and 4m).
      - No numbers in the Scenario Text (describe the setup qualitatively).
      - Put the numbers in the Diagram Description or Question text.
      - Make it a natural story (Indian context, simple names).
      - The number of subquestions and questions generated should be same as the input from the user.
      
    </task>

    <requirements>
      <important>
          TOPIC COVERAGE AND TRACEABILITY (MANDATORY)
            1. Coverage Rule (MANDATORY)
              - You MUST generate questions for EVERY topic mentioned.
              - Do NOT skip, merge, or partially cover any topic.
              - If a topic requires N questions, generate exactly N questions.

            2. Topic Traceability Rule
              - Above EACH question (above scenario), explicitly mention:
                Topic Used: <exact topic name>
              - The topic name must exactly match one of the input topics.
              - The topic should not be mentioned along with the question.

            3. Question Generation Rule
              - Each question must strictly follow the given:
                - Marks
                - DOK level
              - Do NOT change or average these values across topics.
              - Each question should be independent unless explicitly stated otherwise.
              - Metadata of this should be present athe the begining fo the question (before scenario), Dont add topic,marks dok level other things along with the question
            **Continuity rule:**
              When a question has multiple sub-parts (or when two or more items are grouped as a single set), all sub-parts must belong to one continuous scenario — the same storyline, characters and setting — and one sub-part should logically lead to the next. (Continuity applies to the scenario/context, not necessarily the numeric results.)

          
          **Taxonomy Lock Rule**
          - For every question type, the user will explicitly specify:
            - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
            - DOK level
            - Marks
          - You MUST use **only the taxonomy provided for that question type**.
          - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
          - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.
      </important>

      <Scenario Rules>
         Every question MUST begin with a single continuous "Scenario" paragraph that follows these rules:

        1) Scenario-first & form:
          - One continuous paragraph (no bullets/lists), at least four lines long, written like a short real-life story (natural, engaging tone).
          - Use simple, common names. Place the story in an Indian context (locations, ₹ or metric units may be referenced qualitatively), but NEVER use classroom/teacher/student language.

        2) No numeric data in the scenario:
          - Do NOT include explicit numbers, units, or measurements. Describe quantities only qualitatively (e.g., “several boxes,” “a few racks”).
          - All exact values, counts, and measurements must appear only in the diagram prompt or the sub-questions.

        3) One-purpose & realism:
          - The scenario must describe a single, realistic situation that naturally requires the mathematical method being tested.
          - Details must be plausible and logically consistent; avoid exaggeration or impossible quantities.

        4) Functional-consequence (mandatory):
          - The mathematical/ geometric relationship must arise naturally from movement, placement, layout, mapping, or observation in the story — not from engineering, safety rules, inspections, optimization, or explicit design justification.
          - Do NOT explain or justify why the geometry exists; simply describe that it is present.

        5) No repetition across parts:
          - Do NOT repeat scenario details in the diagram or sub-questions. Each section has a distinct role:
            • Scenario = qualitative story/context only.
            • Diagram = numeric/visual representation (introduce numbers/relations).
            • Sub-questions = use diagram numbers to reason and solve.
          - If a fact appears in the scenario, it must NOT be restated numerically elsewhere.

        6) Structure & flow:
          - The story must clearly explain WHY the calculation is needed; subparts must follow directly from the same situation.
          - Only include one clear purpose; do not introduce unrelated secondary ideas.

        7) Variety & reuse:
          - Do not reuse the same scenario type across questions (avoid repeating “shop”, “garden”, etc.). Rotate contexts meaningfully.

        8) Quality check (mandatory before finalizing):
          - Read the scenario aloud: it must sound natural and necessary (not forced).
          - If removing the math would leave the story meaningless, rewrite.
          - If any rule is violated, regenerate the scenario until all rules are satisfied.

        9) You can even make scenarios using daily lif examples of object, for eg : using cycle, bike tyre you can do some angle related questions.Which enables/encourage the students to relate everyday math objects. 
        If any rule cannot be followed, stop and rewrite the scenario to meet these constraints.

        

      </Scenario Rules>

      <Diagram rules>
         - Diagram is optional (unless the topic inherently requires visual representation).
         - If included, give a **diagram prompt** (NOT the actual image).
         - If the topic inherently requires visual representation, then the diagram is mandatory.And the questions in the topic should be image based and everything should be related to the image .
        
        Prompt Guidelines:
        
        **Purpose**: Create exam-ready visual representations that support the question.
        
        **Content Requirements**:
          - It should describe the scene (NOT just "make 2 shapes with these lengths")
          - Must be an image suitable for putting in an exam paper
          - Should contain the scene with marking of values if needed
          - Create a realistic, data-based diagram that directly represents the situation
          - Visually match the setup (e.g., areas, objects, sections, or people mentioned) using relevant numerical values
          - Include only essential measurable details — such as quantities, time, cost, length, or rates — with proper units
          - Keep it simple, consistent, and self-contained
          - The diagram must reflect the same context as the question but present it through clear numbers or labeled visuals
        
        **Format Requirements**:
          - Do NOT give point-by-point descriptions
          - Use continuous narrative that properly defines everything
          - Write as a cohesive description, not a bulleted list
        - For shape-based chapters like triangles, quadrilaterals, circles, or mensuration, do not limit questions to single simple shapes. You may combine multiple shapes within the same structure or layout, similar to how textbooks use combined or connected figures. For example, in the triangles chapter, multiple triangles can be part of one structure to test congruence, similarity, or angle relations (such as SAS, ASA, etc.). These questions should reflect the richness seen in textbooks, but must be original and not an exact copy of any textbook problem.
      </Diagram rules>

      <sub-question rules>
           INSTRUCTION OVERVIEW:
            - Based on the topics specified in the TOPICS_SECTION, generate questions accordingly.
            - For each topic relative to its question count, identify relevant parts of concepts.
            - Use the supplied **Grade** and **Concepts** to determine the appropriate cognitive depth and difficulty for each part.
            - Use the **Concepts** field to choose which sub-skills and problem types to test (e.g., if Concepts include "combined solids" for Surface Area, design items that require combining surface contributions).
            - The solution for all questions and sub-questions must follow the **specific strategy or method** explicitly mentioned under *Concepts* for that chapter (for example, box method, lattice method, partial quotient, repeated addition, etc.).  
              - If the chapter introduces or emphasizes a particular technique (e.g., Box Method for multiplication), then **every relevant calculation in that chapter** must use the same technique, even in simpler sub-questions (both question and solution).  
              - This ensures consistency with what the student is currently being taught at that grade level.  
              - Only if no specific method is mentioned in the concepts should the general grade-appropriate method be used.
            - Difficulty should come from the thinking required, not from complicated wording.
          STRICT TOPIC ADHERENCE
            - You will be given a list of topics with a specific number of questions for each.
            - For each question, strictly use ONLY the concepts from the ONE specific topic assigned to that question.
            - Do NOT mix concepts from different topics within a single question.
            - All parts of the question (Scenario, Sub-questions a, b, c, etc.) must belong to that SAME single topic.
            - Do NOT use concepts from "Topic B" when generating a question for "Topic A", even if both are in the input list.
            - Treat each topic's request as a completely isolated task.
            - **Do not** use or refer to physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
            - Stimulus materials should encourage synthesis from diagram  .

          Question Structure:
            - All sub-questions must be completely based on the scenario only(Dont give question outside the scenario), not on outside knowledge or assumptions. 
            - But for DOK 3 You may include questions that go slightly beyond the scenario only if they are logically connected and require deeper reasoning or application based on the scenario.
            Each CBS should include {{Number_of_subparts}} parts, each corresponding to one sub-question.
            {{SUBPARTS_SECTION}}
            - Ensure the difficulty, DOK level, and cognitive demand match the part’s configuration.
            - Based on the DOK level and the difficulty you need to generate the question accordingly.

          COGNITIVE INDIRECTNESS RULE (MANDATORY):

              All questions must be grade-appropriate in mathematical level,
              but the required relationship must NOT be directly visible or immediately usable.

              The student should NOT be able to answer by applying one property immediately after reading the question.

              Instead, the question must require the student to FIRST interpret the diagram
              and identify hidden or intermediate relationships before using the target concept.

              This means:

              • The required angles should not be labelled in an obvious pair.
              • The needed relationship should be embedded among other angles.
              • An intermediate angle or relation must be recognized before solving.
              • The question must require interpretation BEFORE calculation.

              Direct question patterns that are NOT allowed:
              ❌ “Find x if these two angles form a linear pair”
              ❌ “Name the vertically opposite angles”
              ❌ “If l || m find angle ABC”
              ❌ Any question where the used property is explicitly stated or visually isolated.

              Allowed question style:
              ✔ Student must determine WHICH angles are related first.
              ✔ Student must locate the correct relationship from multiple possibilities.
              ✔ Student must derive an intermediate angle before the final step.
              ✔ The diagram contains extra information not immediately useful.

              The mathematics must remain Grade level,
              but the path to the concept must require recognition, interpretation, and selection.
              If a student can identify the required property within 5 seconds of reading the question,
              the question is too direct and must be redesigned.
                      
      </sub-question rules>

      <solution rules>
          
        1. Solution

        Provide complete step-by-step solutions for each sub-part.

        Follow these rules strictly:

        - Show all calculation steps clearly and logically.
        - Break the solution into small scoring steps.
        - Assign marks to each step (value-point marking).
        - Present the final answer clearly with units.
        - Do NOT include explanations beyond what is needed for solving.
        - For DOK 3 parts, include one additional line at the end:

          Logical-operation sequence (DOK 3):  
          [Write the reasoning flow in short action steps such as  
          Interpret constraints → Form plan → Compute → Check → Final answer]

      </solution rules>

      <key_idea rules>
        KEY IDEA

          1. What kind of problems these are  
            Explain simply what students are trying to find in such problems.

          2. Core idea behind these problems  
            Teach the main idea from the beginning in very simple terms.

          3. Why this idea works  
            Explain the logic in real understanding, not as a rule to memorize.

          4. General step-by-step method  
            Step 1:  
            Step 2:  
            Step 3:  
            Step 4:  

          5. Common mistakes students make  
            Mention at least two mistakes and why they happen.

          6. Tips to avoid these mistakes  
            Give practical student-friendly advice.

          The explanation must naturally include the rule or principle used, but blended into teaching — not as a separate definition.

          Do not include anything else.

      </key_idea rules>
      
      <question_enhancement_idea>

        Use textbook-style geometric structure as inspiration (clarity, multiple relations, meaningful layout), but DO NOT copy any figure. Reconstruct a new configuration that shows layered relationships (intersections, parallels, transversals, angle links) rather than a single simple shape.
        Each diagram must support reasoning across multiple connected elements, and every question must depend on these structural relationships — not just direct measurement or one-step observation.
        Analyse the exercise of each topic so that you can make better questions. Better figures, common figures are not required try to make outside the box figures which is realastic

        - you should use indian names and environments
      </question_enhancement_idea>
      <DOK_level_explanation>
            COGNITIVE DEPTH & OLYMPIAD REASONING MODE (MANDATORY)

            All questions must be grade-appropriate in content,
            but non-direct and structure-based in reasoning.

            The required concept must NOT be immediately usable.
            Students must interpret the situation, identify relationships,
            and use intermediate reasoning before reaching the answer.

            --------------------------------
            DOK STRUCTURAL DEFINITIONS
            --------------------------------

            DOK 1 — Recognition
            • Identify, label, classify, or read directly.
            • No calculation.
            • No inference chain.

            DOK 2 — Sequential Application
            • Solve using TWO or more connected steps.
            • Must require an intermediate result.
            • Must combine different pieces of information.

            DOK 3 — Constraint-Based Reasoning
            • A condition or claim must be evaluated.
            • Student must analyse relationships across the whole structure.
            • Answer must be justified by consistency, necessity, or elimination.
            • Requires interpretation before solving.

            --------------------------------
            OLYMPIAD STRUCTURE RULES
            --------------------------------

            • The solution path must not be obvious.
            • Multiple elements must interact (not a single relation).
            • Some information should be indirect or distracting.
            • The answer must be forced by constraints, not direct substitution.
            • At least one intermediate inference must be necessary.

            --------------------------------
            DIRECTNESS CHECK (MANDATORY)
            --------------------------------

            If the required method is obvious immediately,
            or a single direct step gives the answer,
            the question must be redesigned.

                  
            - whatever you are thinking to make question make it one lvel up so that it will be in proper dok level
      </DOK_level_explanation>
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - EXCEPTION: You may generate a proof-based question ONLY if the user explicitly requests it in the "Additional Notes" section.

      </what_not_to_do>
    </requirements>
    
    <output_format>
      Return a valid JSON object:
      {
        "questions": [
          {
            "question_id": "Q1 (matching input)",
            "scenario_text": "The narrative story (no numbers).",
            "diagram_description": "Description of the visual setup with values.",
            "questions_list": [
              "Sub-question 1",
              "Sub-question 2..."
            ],
            "solution": "Solution for all sub-questions",
            "key_idea": "Key idea for all sub-questions"
          },
          ...
        ]
      }
    </output_format>
  </writer_generation>



# ===================================================================
# MCQ PROMPTS
# ===================================================================

mcq_math_core: |
  <math_core_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <chapter>{{Chapter}}</chapter>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
      The user needs the following specific questions designed:
      {{Question_Specific_Requirements}}
    </design_requirements>
    
    <task>  
      You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

      STRICT RULES:  
      - Do NOT write a story.  
      - Do NOT write a scenario.  
      - Do NOT restate or display DOK level, marks, or any metadata provided in the input.  
      - ONLY design the mathematical structure and logic that will generate the question.  
      - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

      For EACH question listed in <design_requirements>, define:

      1. **Abstract Math Structure**  
        - The underlying mathematical framework (e.g., Right Triangle, Linear Pair, Quadratic Curve, etc.)  
        - Must be deep enough to support the required reasoning complexity.

      2. **Topic Identification and Description**  
        - Identify the specific mathematical topic being used.  
        - Provide a brief description of the topic, including the main concepts or component ideas within it.

      3. **Subtopic Differentiation (ONLY if multiple questions share the same topic)**  
        - Identify a distinct subtopic for each question.  
        - Subtopics must be unique across questions.  
        - Subtopics must come from conceptual analysis (textbook structure, concept hierarchy, or progression of ideas).

    </task>

    <requirements>

      1. TOPIC ANALYSIS  
        - For each given topic, describe the conceptual coverage (what ideas, properties, or methods belong to it).  
        - If multiple questions use the same topic, assign different subtopics within that topic.

      2. STRUCTURAL COMPLEXITY  
        - The math structure must be sufficiently rich to support the required reasoning level.  
        - The structure must naturally produce the intended mathematical task.

      3. ADDITIONAL NOTES (MANDATORY)  
        - Any condition, restriction, or design instruction provided must be incorporated into the structure.

      4. OUTPUT RESTRICTIONS  
        - Do NOT include DOK level, marks, scoring, pedagogy labels, or curriculum references.  
        - Only output structural mathematical design.

    </requirements>
    
    <output_format>
      Return a valid JSON object:
      {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name and its description",
            ...
          },
          ...// next object(question) with same structure
        ]
      }
    </output_format>
  </math_core_generation>

mcq_writer: |
  <writer_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <requirements>{{Question_Requirements}}</requirements>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>

    <math_blueprint>
      {{MATH_CORE_DATA}}
    </math_blueprint>

    <task>
      Generate {{TOTAL_QUESTIONS}} Multiple Choice Questions (MCQs) based on the inputs above and.

      Each question must:
        
        - Generate **original** questions that are not copied, adapted, or rephrased from textbooks or existing items.
        - Ensure all mathematics is **accurate**, with logically sound reasoning and correct solutions.
        - Each question must be **distinct** and not resemble previously generated items.
        - Align every question with the specified **DOK level** and **cognitive taxonomy**.
        - Ensure the difficulty, language, and structure are **appropriate for the target grade**.
      - Use only the concepts listed in the specified topics.
        - Design questions that assess **conceptual understanding**, not just routine procedures.

    </task>
       - Start with the explicit metadata: "Topic Used: <topic>"
        - Additional Notes from user: {{Additional_Notes}}
    <requirements>
      <important>
          TOPIC COVERAGE AND TRACEABILITY (MANDATORY)
            1. Coverage Rule (MANDATORY)
              - You MUST generate questions for EVERY topic mentioned.
              - Do NOT skip, merge, or partially cover any topic.
              - If a topic requires N questions, generate exactly N questions.

            2. Topic Traceability Rule
              - Above EACH question (above scenario), explicitly mention:
                Topic Used: <exact topic name>
              - The topic name must exactly match one of the input topics.
              - The topic should not be mentioned along with the question.

            3. Question Generation Rule
              - Each question must strictly follow the given:
                - Marks
                - DOK level
              - Do NOT change or average these values across topics.
              - Each question should be independent unless explicitly stated otherwise.
              - Metadata of this should be present athe the begining fo the question (before scenario), Dont add topic,marks dok level other things along with the question
            **Continuity rule:**
              When a question has multiple sub-parts (or when two or more items are grouped as a single set), all sub-parts must belong to one continuous scenario — the same storyline, characters and setting — and one sub-part should logically lead to the next. (Continuity applies to the scenario/context, not necessarily the numeric results.)

          
          **Taxonomy Lock Rule**
          - For every question type, the user will explicitly specify:
            - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
            - DOK level
            - Marks
          - You MUST use **only the taxonomy provided for that question type**.
          - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
          - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.
      </important>
      <MCQ_Structure>
          Each MCQ must have:

            1. **Question**: A clear, well-formulated question that tests the specified concept
              - Use student-friendly language appropriate for {{Grade}}
              - Names should be simple and commonly used  (eg : Jack	Anna  Ryan	Emily	Sam	Maria	John	)
              
                  DO NOT use academic or classroom settings.
                  This means NO:
                  - teacher, student, class, quiz, test, homework, assignment, exam, studying
              - Avoid ambiguous wording
              - Include all necessary information
              - Use correct mathematical notation

            2. **Four Answer Choices**: Exactly 4 options labeled A, B, C, D
              - **1 Correct Answer**: The only mathematically correct solution
              - **3 Distractors**: Plausible but incorrect options

            3. **Solution**: Step-by-step solution showing how to arrive at the correct answer
              - Clearly explain the reasoning
              - Show all mathematical steps
              - Justify why the correct answer is right

            4. **Distractor Analysis**: For each of the 3 distractors, explain:
              - Why a student might choose this incorrect option
              - What misconception or error leads to this answer
              - How to correct the misunderstanding
              - It should be maximum of 4 lines 

       </MCQ_Structure>

       <types_of_mcq>
           1. MCQ (Number Based)
              Description:
                A question that presents information entirely using numbers, symbols, or units.
                There is no image and no real-world narrative.
                Students operate purely on abstract or quantitative data (comparison, place value, unit conversion, arithmetic, patterns, etc.).
              Example:
                Choose the smallest number from the given options.
                Options:
                A) 3,80,912
                B) 3,89,012
                C) 3,98,012
                D) 3,89,100

            2. MCQ (Image Based)
              Description:
                A question where the image or diagram provides the critical mathematical information needed to answer.
                There is no real-world story. The reasoning is visual/structural (shapes, geometry, patterns, fold symmetry, matchsticks, etc.).
                Options may also appear as visuals.
              Example (with Diagram Prompt):
                Diagram Prompt:
                Draw two matchstick figures:
                - Figure A: three matchsticks forming an open V-shape
                - Figure B: the same three matchsticks rearranged into a closed triangle
                All matchsticks are equal in length, no measurements.
                Question:
                The matchsticks in Figure A are joined to form a triangle as shown in Figure B. What type of triangle is it?
                Options:
                A) Equilateral Triangle
                B) Scalene Triangle
                C) Isosceles Triangle
                D) Right-Angled Triangle

            3. MCQ (Real-World Word Questions)
              Description:
                A question framed using a real-life situation described only in words - no images.
                Students translate the scenario into mathematical reasoning (measures, money, packing, production, containers, etc.).
              Example:
                A sugar factory produced 7 quintals of sugar.
                The sugar is priced and packed per kilogram.
                How many kilograms of sugar did they produce?
                Options:
                  A) 7 kg
                  B) 70 kg
                  C) 700 kg
                  D) 7,000 kg

            4. MCQ (Real-World Image-Based Word Questions)
              Description:
                A real-life scenario where both the image and the text are jointly required to answer.
                The image presents practical or quantitative information (weights, objects, arrangements, packaging, etc.).
              Example (with Diagram Prompt):
                Diagram Prompt:
                Draw four flour packets arranged in a row.
                Label them:
                - Packet 1: "1 kg"
                - Packet 2: "1 kg"
                - Packet 3: "1 kg"
                - Packet 4: "500 g"
                Avoid background scenery.
                Question:
                Arun bought several flour packets, as shown in the picture.
                What is the total weight of the flour he bought?
                Options:
                • 3 kg 500 g
                • 4 kg 500 g
                • 4 kg
                • 3 kg 150 g

            ## MCQ Type Selection Rule (CRITICAL)
            - In the TOPICS_SECTION, each question may optionally specify an "MCQ Type".
            - If "MCQ Type" is specified, you **MUST STRICTLY** generate a question that fits that specific definition and style.
            - If "MCQ Type" is "Auto" or NOT specified, you must choose the most appropriate type based on the topic and grade level, ensuring variety across the set.

            For each question, you must specify:
              - **MCQ Type**: (Number Based / Image Based / Real-World Word / Real-World Image-Based Word)
              - **Mark of question**: {{Marks}}
              - **DOK level of question**: {{DOK_Level}}
              - **Taxonomy of question**: {{Taxonomy}}
              - **Statement Based**: (YES/NO)
                  
       </types_of_mcq>
       <solution_generation>
            [Provide step-by-step solution showing how to arrive at the correct answer. Include all reasoning and calculations and the mark split.]

       </solution_generation>

       <distractor_analysis>
          For every mcq question, a Distractor Analysis is compulsory.

            1. Distractor Design Rule
              Each incorrect option MUST be intentionally framed using exactly ONE identifiable mathematical error type. 
              Distractors must reflect realistic student mistakes and must not be random, vague, or purely eliminative.
              Do NOT mix multiple error types within a single option.
              - You should only select error type from the list provided below ( 4 type of errors)
              - You should not repeat the same error type for all options.
              - Do not use phrases such as “the student might think” or “the student might choose” in the distractor analysis, because the explanation is addressed to the learner directly.	
            2. Permitted Error Types (Use ONLY these)

              A. Conceptual Error  
                Definition: Arises from an incorrect understanding of a mathematical concept, rule, or property, leading to the wrong method or idea being applied.  
                Nature: Misunderstanding what concept should be used.  
                Use in distractors: Target common misconceptions.
                eg : Examples:
                    • Believing (a+b)^2 = a^2 + b^2
                    • Using the area formula when the perimeter is required
                  Use in distractors:
                    Targets common misconceptions.

              B. Computational Error  
                Definition: Occurs when the correct concept and method are chosen, but a mistake is made during arithmetic or algebraic computation.  
                Nature: Careless calculation or manipulation error.  
                Use in distractors: Capture calculation-based mistakes.
                Examples:
                  • 7 \times 8 = 54
                  • Sign error: -4 + 6 = -10
                  • Incorrect simplification: \frac{6}{3} = 1
                Use in distractors:
                  Captures careless calculation mistakes.
              C. Communicational Error  
                Definition: Occurs when the student understands the mathematical concept and solution
                but expresses the answer using incorrect notation, symbols, format, or units.  
                Nature: Error in mathematical communication or representation.  
                Use in distractors: Test notation, symbols, units, and expression clarity.

                Examples:
                  Writing x = 2 instead of x ± 2
                  Writing x = 3 instead of x ≥ 3
                  Giving 30 instead of 30 km/h
                  Writing x = 1,2 instead of {1,2}

                  Use in distractors:
                  Tests mathematical communication and notation skills.
              D. Comprehension Error    
                Definition: Occurs when the student correctly understands the mathematical concepts
                but misreads, overlooks, or ignores explicit instructions, conditions, or keywords
                in the question.  
                Nature: Error in interpreting what is asked, not in understanding mathematics.
                Use in distractors: Identify reading comprehension and instruction-following weaknesses.
                Examples:
                  • Finding the area when the question asks for perimeter
                  • Ignoring words like “number of solutions”, “at most”, “except”
                  • Solving for x when the question asks for the value of an expression
                  Use in distractors:
                    Identifies weaknesses in reading comprehension and attention to detail.
            Distractor analysis should explain the reasoning abstractly, without referencing textbook pages, sections, or verbatim excerpts.
            ### Error-Type Classification Gate (MANDATORY)

                Before assigning an error type to any distractor, apply this gate:

                1. If the student’s mistake would STILL occur even if the question were reworded or simplified,
                  then it is NOT a Comprehension Error.

                2. Comprehension Error may be used ONLY when:
                  - the student ignores or misreads an explicit instruction, keyword, or condition
                  - AND the mathematical concept itself is correctly understood

                3. Any misunderstanding of:
                  - sign (positive / negative / zero)
                  - number properties
                  - definitions
                  - term meaning (e.g., “negative”, “odd”, “multiple”)
                  MUST be classified as a Conceptual Error, not Comprehension.
              ### Error-Type Decision Table (MANDATORY)

            | Observed Student Mistake | Correct Error Type |
            |--------------------------|-------------------|
            | Thinks 0 is negative | Conceptual Error |
            | Uses wrong formula | Conceptual Error |
            | Ignores word like “except”, “first”, “at most” | Comprehension Error |
            | Solves correctly but answers a different quantity | Comprehension Error |
            | Arithmetic slip with correct method | Computational Error |
            | Wrong units / notation / symbol | Communicational Error |

          IMPORTANT EXCLUSION:
            If the error arises from misunderstanding a mathematical definition, property,
            classification, or meaning (e.g., sign of a number, term meaning, formula components),
            it MUST be classified as a Conceptual Error, not Comprehension.

            -- First finalize on what type of error will be used then make options based on that error type.

        **OUTPUT FORMAT: The distractor analysis MUST be presented as a markdown table with two columns: "Option" and "Misconception"**. The “Option” column must display the option label followed by the assigned error type, separated by a hyphen (e.g., B – Conceptual Error).

          For each incorrect option (3 distractors), follow this exact explanation structure:


        **Option [X]: [The incorrect answer]**

        **Why students might select this:**
        - Begin by identifying the likely mistake: "You selected this option because you likely…"
        - Explain the specific error or misconception that leads to this answer
        - Be specific about what went wrong (e.g., "used addition instead of multiplication", "confused the formula", "forgot to convert units")

        **What's wrong with this approach:**
        - Explain clearly why this reasoning is incorrect
        - Show the correct concept or procedure that should have been used
        - Use mathematical reasoning to demonstrate the error

        **Correct approach:
        - Briefly state what the student should have done instead
        - Connect back to the correct answer
        ### Mandatory Distractor Analysis for DOK 2 questions for grade 6 and upper (for statement based questions)

          When providing distractor analysis for DOK 2 grade 6 adn upper questions, follow the format and rules below strictly.

          #### Core Requirement
          The distractor analysis MUST:
          1. State which statements were correctly identified as true.
          2. Explicitly state any true statement that the student failed to identify.
          3. Explicitly explain why any incorrect statement was mistakenly identified as true.

          #### Mandatory Structure
          Use the exact narrative structure below (modify only statement numbers and reasons):

          "You have identified that Statement ___ is true.  
          But you missed to identify that Statement ___ is also a true statement.  
          You might have thought so since ___ (reason category: computational / conceptual / communication / comprehension).  
          Also, you thought that Statement ___ is a correct statement since ___ (specific reason)."

          #### If Multiple Statements Are Correctly Identified
          - Clearly acknowledge all correctly identified statements.
          - Then address each incorrectly identified statement individually with a reason.

          #### Reason Specification Rules
          - Reasons must be **specific and concrete**, not vague.
          - Acceptable examples include:
            - You might have misunderstood a parallelogram as a square.
            - You might have forgotten to apply the theorem.
            - You might have added instead of subtracting.
            - You might have missed noticing a condition in the question.
            - You might be unaware of the relevant property or rule.
          - Always classify the error under one of the following:
            **computational / conceptual / communication / comprehension**

          #### Output Constraint
          - Do NOT change the tone or structure.
          - Do NOT omit either:
            - the reason for missing a true statement, or
            - the reason for selecting a false statement.
          - This format is mandatory for all statement-based distractor analyses.
        **CRITICAL Distractor Analysis Requirements:**
        - **Maximum Length**: Each distractor rationale must be **4 lines maximum** (total for all three sub-sections combined)
        - **Child-Friendly Language**: Use simple, age-appropriate language suitable for {{Grade}}
        - **Concise and Clear**: No verbose explanations - keep it short and focused
        - **Educational Tone**: Be supportive, not condescending
        - Do NOT say: "You correctly identified that…" for an incorrect option
        - Include mathematical notation when needed, but keep it minimal
        - Make sure each distractor analysis is unique and addresses a different type of error
        - Do Not explicitly say  "Why students might select this" , "What's wrong with this approach" , "Correct approach" in the distractor analysis (you are the one who is explaining the distractor analysis)
        - Make sure each distractor analysis is of maximum 4 lines
        Error-Type Diversity Rule (MANDATORY):
          Each of the three distractors must be based on a different error type.
          No two distractors may rely on the same underlying mistake, even if expressed differently.
        

        **Example:**
            | Distractors | Misconception |
            |------------|----------------|
            | B – Conceptual error | You correctly identified that Statement I is true, but you might have misunderstood the term “first five.” The sum of the first five consecutive odd numbers (1 + 3 + 5 + 7 + 9) is 25, not 4³ = 64. Since Statement II is mathematically incorrect, this option is incorrect as a whole. |
            | C – Computational Error   | You correctly identified that Statement I is true, but you might have assumed that the sum of any three odd numbers always equals 3³ = 27. For example, 1 + 3 + 5 equals 9, not 27. Because Statement III is incorrect, this option is incorrect. |
            | D – Comprehension Error | You correctly identified that Statement I is true, but you might have misunderstood two ideas: believing that any three odd numbers always sum to 27, and assuming that the sum of consecutive odd numbers is always odd. For example, 1 + 3 = 4 (even). Since Statement III and Statement IV are both incorrect, this option is wrong. |


       </distractor_analysis>

       <statement_based_Mcq>
         
          When generating **statement-based questions**, follow all rules below strictly.

          ### Stem Requirement (Mandatory)
          - First create a **clear stem** (context, situation, figure, expression, or given information).
          - All numbered statements (I, II, III, IV) must be **directly derived from this stem**.
          - Statements must NOT be independent or unrelated facts.
          - Each statement should test interpretation, evaluation, or application of the given stem.

          ### Statement Structure
          - Provide **multiple numbered statements** (e.g., I, II, III, IV).
          - Each statement must be independently verifiable as **true or false** based only on the stem.
          - Avoid ambiguous or overlapping statements.

          ### Options Structure
          - Options must be **combinations of statement numbers**, such as:
            - I and II only
            - I, III and IV only
          - There must be **exactly one correct combination**.
          - No two options may represent the same logical outcome.

          ### Correct Answer Rule
          - Clearly identify which statements are **true**.
          - The correct option must include **all and only** the true statements.

          ### Distractor Analysis Requirement (Mandatory)
          For **each incorrect option**, provide a distractor analysis that:

          1. States which statements were **correctly identified**.
          2. States which **true statements were missed**, if any.
          3. States which **false statements were incorrectly identified as true**.
          4. Gives a **specific reason** for each error.
          5. Classifies each error under one of the following:
            - Computational
            - Conceptual
            - Communication
            - Comprehension

          ### DOK 2 Question Framing Rule for Statement-Based Questions

            When the **input DOK level is DOK 2**, apply the following rules strictly while generating or validating questions:

            • **Up to Grade 5**  
              - DOK 2 questions must involve **identifying whether a single statement is correct or incorrect**.
              - Do NOT ask for combinations of statements at this level.

            • **Grade 6 and Above**  
              - DOK 2 questions involve **identifying the correct combination of statements** (e.g., I & III, II & IV).
              - Students are expected to evaluate and compare multiple statements, but **no justification or reasoning** should be required.



       </statement_based_Mcq>

       
      <key_idea rules>
        KEY IDEA

          1. What kind of problems these are  
            Explain simply what students are trying to find in such problems.

          2. Core idea behind these problems  
            Teach the main idea from the beginning in very simple terms.

          3. Why this idea works  
            Explain the logic in real understanding, not as a rule to memorize.

          4. General step-by-step method  
            Step 1:  
            Step 2:  
            Step 3:  
            Step 4:  

          5. Common mistakes students make  
            Mention at least two mistakes and why they happen.

          6. Tips to avoid these mistakes  
            Give practical student-friendly advice.

          The explanation must naturally include the rule or principle used, but blended into teaching — not as a separate definition.

          Do not include anything else.

      </key_idea rules>

      <question_cognitive_indirectness_rule>
              All questions must be grade-appropriate in mathematical level,
              but the required relationship must NOT be directly visible or immediately usable.

              The student should NOT be able to answer by applying one property immediately after reading the question.

              Instead, the question must require the student to FIRST interpret the diagram
              and identify hidden or intermediate relationships before using the target concept.

              This means:

              • The required angles should not be labelled in an obvious pair.
              • The needed relationship should be embedded among other angles.
              • An intermediate angle or relation must be recognized before solving.
              • The question must require interpretation BEFORE calculation.

              Direct question patterns that are NOT allowed:
              ❌ “Find x if these two angles form a linear pair”
              ❌ “Name the vertically opposite angles”
              ❌ “If l || m find angle ABC”
              ❌ Any question where the used property is explicitly stated or visually isolated.

              Allowed question style:
              ✔ Student must determine WHICH angles are related first.
              ✔ Student must locate the correct relationship from multiple possibilities.
              ✔ Student must derive an intermediate angle before the final step.
              ✔ The diagram contains extra information not immediately useful.

              The mathematics must remain Grade level,
              but the path to the concept must require recognition, interpretation, and selection.
              If a student can identify the required property within 5 seconds of reading the question,
              the question is too direct and must be redesigned.

      </question_cognitive_indirectness_rule>

            
      <question_enhancement_idea>

        Use textbook-style geometric structure as inspiration (clarity, multiple relations, meaningful layout), but DO NOT copy any figure. Reconstruct a new configuration that shows layered relationships (intersections, parallels, transversals, angle links) rather than a single simple shape.
        Each diagram must support reasoning across multiple connected elements, and every question must depend on these structural relationships — not just direct measurement or one-step observation.
        Analyse the exercise of each topic so that you can make better questions. Better figures, common figures are not required try to make outside the box figures which is realastic

      </question_enhancement_idea>

       <DOK_level_explanation>
            COGNITIVE DEPTH & OLYMPIAD REASONING MODE (MANDATORY)

            All questions must be grade-appropriate in content,
            but non-direct and structure-based in reasoning.

            The required concept must NOT be immediately usable.
            Students must interpret the situation, identify relationships,
            and use intermediate reasoning before reaching the answer.

            --------------------------------
            DOK STRUCTURAL DEFINITIONS
            --------------------------------

            DOK 1 — Recognition
            • Identify, label, classify, or read directly.
            • No calculation.
            • No inference chain.

            DOK 2 — Sequential Application
            • Solve using TWO or more connected steps.
            • Must require an intermediate result.
            • Must combine different pieces of information.

            DOK 3 — Constraint-Based Reasoning
            • A condition or claim must be evaluated.
            • Student must analyse relationships across the whole structure.
            • Answer must be justified by consistency, necessity, or elimination.
            • Requires interpretation before solving.

            --------------------------------
            OLYMPIAD STRUCTURE RULES
            --------------------------------

            • The solution path must not be obvious.
            • Multiple elements must interact (not a single relation).
            • Some information should be indirect or distracting.
            • The answer must be forced by constraints, not direct substitution.
            • At least one intermediate inference must be necessary.

            --------------------------------
            DIRECTNESS CHECK (MANDATORY)
            --------------------------------

            If the required method is obvious immediately,
            or a single direct step gives the answer,
            the question must be redesigned.

                  
            - whatever you are thinking to make question make it one lvel up so that it will be in proper dok level
      </DOK_level_explanation>
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <taxonomy>
        **Taxonomy Lock Rule**
        - For every question type, the user will explicitly specify:
          - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
          - DOK level
          - Marks
        - You MUST use **only the taxonomy provided for that question type**.
        - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
        - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.

        
      </taxonomy>

      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.

      </what_not_to_do>
       
    </requirements>

    <output_format>
      Return a valid JSON object:
      {
        "questions": [
          {
            "question_id": "Q1",
            "question_text": "...",
            "options": {
              "A": "...",
              "B": "...",
              "C": "...",
              "D": "..."
            },
            "correct_option": "A/B/C/D",
            "solution": "Brief explanation...",
            "distractor_analysis": "Distractor Analysis...",
            "key_idea": "Key concept..."
            
          },
          // .. next question in same format
        ]
      }
    </output_format>
  </writer_generation>


# ===================================================================
# FILL IN THE BLANKS (FIB) PROMPTS
# ===================================================================

fib_math_core: |
  <math_core_generation>
    <question_type>Fill in the Blanks</question_type>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
         {{Question_Specific_Requirements}}
    </design_requirements>

    <task>  
      You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

      STRICT RULES:  
      - Do NOT write a story.  
      - Do NOT write a scenario.  
      - Do NOT restate or display the Topic name.  
      - Do NOT display DOK level, marks, or any metadata provided in the input.  
      - ONLY design the mathematical structure and logic that will generate the question.  
      - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

      For EACH question listed in <design_requirements>, define:

      1. **Abstract Math Structure**  
        - The underlying mathematical framework (e.g., Linear Pair, System of Equations, Right Triangle with altitude, etc.)  
        - Must be deep enough to logically support all required sub-questions.

      2. **Sub-question Logic**  
        - Explain how the structure supports multiple sub-questions in a progressive or connected way.  
        - The structure must naturally allow increasing reasoning complexity.

      3. **Sub-question Breakdown**  
        For EACH sub-question provide:
        - **Subtopic (unique — cannot repeat across sub-questions)**  
        - **Brief Description** explaining what mathematical idea or operation is being tested.

    </task>

    <requirements>

      1. SUBTOPIC SELECTION  
        - Identify different subtopics from within the given topic domain.  
        - Each sub-question MUST use a distinct subtopic.  
        - Subtopics must come from concept analysis (textbook, syllabus progression, or logical concept hierarchy).

      2. STRUCTURAL COMPLEXITY  
        - The math structure must be sufficiently rich to support all sub-questions logically.  
        - Sub-questions must emerge naturally from the same structure (not disconnected tasks).

      3. ADDITIONAL NOTES (MANDATORY)  
        - If any constraint, condition, value restriction, or design instruction appears in Additional Notes, it MUST be incorporated into the structure and sub-question logic.

      4. OUTPUT RESTRICTIONS  
        - Do NOT include:DOK level, marks, scoring, pedagogy labels,explanation of curriculum alignment, or **how to make questions**.  
        - Only output structural mathematical design.

    </requirements>
    
    <output_format>
      Return a valid JSON object:
        {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name",
            "subquestion_1": "subtopic and its description",
            "subquestion_2": "subtopic and its description",
            ...
          },
          ...// next object with same structure
        ]
      }
    </output_format>
  </math_core_generation>

fib_writer: |
  <writer_generation>
    <context>
       <grade>{{Grade}}</grade>
       <requirements>{{Question_Requirements}}</requirements>
       <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    <math_blueprint>
       {{MATH_CORE_DATA}}
    </math_blueprint>
    <task>
       Write the FIB question. Use "|TEXT N| or |DROP N|" for the blank.
       Start with "Topic Used: <topic>".
    </task>

    <requirements>
                 Fill in the Blanks questions are used to assess mathematical understanding where
            students must supply missing information directly, without being guided step-by-step.
            FIB questions may include THREE distinct answer-handling types:
            
            1. UNIQUE-ANSWER FIB (TEXT ENTRY)
            • Use when:
              - Only ONE mathematically correct answer exists.
              - Use for ALL numerical or computational questions.
              - Allow ONLY ONE correct answer.
              - No alternative wording or representation is acceptable.

            • Format:
              - Use |TEXT n| placeholders.
              - No dropdowns, no options shown to students.

            • Answer Key Rules:
              - Provide exactly one correct value.
              - Do NOT add unnecessary variants.

            • Typical use cases:
              - Exact values,
              - Final inferred results,
              - Constrained outcomes after reasoning.

            • Example (validated):
              TEXT1: 196
              TEXT2: 225
              TEXT3: 14

            2. PROBABLE-ANSWER FIB (TEXT ENTRY)
            • Use when:
              - The correct answer can be written in multiple valid ways.
              - Use when the SAME correct answer can be written in MULTIPLE valid ways
                (word form, number form, equivalent expressions, accepted terminology).

            • Format:
              - Use placeholders: |TEXT 1|, |TEXT 2|, etc.
              - Do NOT provide options inside the question.
              - Student response is free text.

            • Answer Key Rules:
              - All acceptable answers must be listed.
              - Separate probable answers using a semicolon (;).
              - Do NOT include unnecessary variations.
              - Only mathematically and linguistically valid equivalents are allowed.

            • Example (validated):
              |TEXT 1| → single; one; 1

            • Important:
              - The blank must NOT reduce to a single forced representation.
              - If only one exact response is possible, this is NOT a probable-answer FIB.
            
            3. DROP-DOWN FIB (CONTROLLED SELECTION)
            
            • Use when:
              - Use when there are TOO MANY probable answers to manage fairly in free-text entry.
              - Provide a fixed option set with EXACTLY ONE correct answer.
              

            • Format:
              - Use placeholder: [DROP]
              - Explicitly list dropdown options for each blank.
              - Each [DROP] has its own option set.

            • Rules:
              - Other options must be close and plausible so the student must think carefully.
              - Options must be mutually exclusive.
              - Exactly one option must be correct.
              - Avoid trivial elimination.

            • Example (validated):
              [DROP] → (Red, Green, Black, Blue)
      ** Based on the topic, grade level, and concepts being assessed, you may choose the most appropriate Fill in the Blanks type (unique-answer, probable-answer, or drop-down); a single topic may include a mix of all three types, and where visual understanding is required, you may include a diagram prompt describing the image to be shown (for visualization purposes only), ensuring the diagram contains only essential visual information and does not include labels, values, or clues that directly reveal the answer.


        EXAMPLE 1: UNIQUE ANSWER (Numerical – only one correct answer)

          Question:
          Find the value of x if:
          5x − 15 = 0  
          x = |TEXT1|

          Answer:
          TEXT1: 3

          Solution Explanation:
          5x − 15 = 0  
          ⇒ 5x = 15  
          ⇒ x = 3  
          Since this is a numerical equation, there is only one correct value of x.


          ------------------------------------------------------------

          EXAMPLE 2: PROBABLE / MULTIPLE ANSWERS (Descriptive – more than one valid form)

            Question:
            Write the number name of 12.
            |TEXT1|

            Answers:
            TEXT1: twelve; Twelve

            Solution Explanation:
            The question checks the understanding of number names.
            Both "twelve" and "Twelve" represent the same correct answer.
            Hence, multiple acceptable answers are allowed.


          ------------------------------------------------------------

          EXAMPLE 3: DROPDOWN QUESTION (Selection from given options)

            Question:
            A right angle measures [DROP] degrees.

            Drop-down Options:
            [DROP] → (45, 90, 180, 360)

            Answer:
            [DROP]: 90

            Solution Explanation:
            By definition, a right angle measures exactly 90 degrees.
            The correct option must be selected from the given choices.
      4.  Marks and Blanks Rules (STRICT RULE):

        - Each blank or dropdown must carry either **0.5 mark or 1 mark only** but give preference to 0.5 marks blank.
        - No blank or dropdown can have marks **less than 0.5 or more than 1**, and no other intermediate values are allowed.
        - Wherever possible, prioritize using blanks with **0.5 marks** (e.g., split a 1-mark question into two 0.5-mark blanks).

        - For a **1-mark question**:
          - Use **one blank of 1 mark**, OR
          - Use **two blanks of 0.5 mark each**.

        - For a **2-mark question**:
          - Use **at least two blanks** (any valid combination of 0.5 or 1 mark each).

        - For a **3-mark question**:
          - Use **at least three blanks** (any valid combination of 0.5 or 1 mark each).

        - It is allowed to include **multiple blanks and/or dropdowns** as appropriate to the question type, provided the above marking rules are satisfied.
        - Each blank should carry marks in proportion to its allotted value.
        

        
      </fib_question_structure>

      <types_of_fib_questions>
         1. Fill in the Blank (Number Based)
            Description:
              A fill-in-the-blank question using only numeric or symbolic information (numbers, patterns, sequences, units, place value). 
              There is no image and no real-world narrative. Students rely purely on quantitative or abstract reasoning.
            Examples:
              10,000 was added five times.
              Now to reach 52,500 with the least number of steps, 1,000 should be added |TEXT1| times and 100 |TEXT2| times.

              In a sequence of 9 consecutive numbers starting with 401.
              The number of odd numbers is |TEXT1|
              The number of even numbers is |TEXT2|
              The largest odd number in the sequence is |TEXT3|
              The smallest even number in the sequence is |TEXT4|

              Look at the pattern:
              684, 689, 694, 699, 704, ___
              The next term in the sequence is |TEXT1| which is an [DROP2] number.
              The value of the 5th even term in the sequence is |TEXT3|.

        2. Fill in the Blank (Image Based)
            Description:
              A fill-in-the-blank question where the image/diagram provides the key mathematical information.
              There is no real-world narrative. Students must visually interpret the diagram.
            Example (with Diagram Prompt):
              Diagram Prompt:
              Draw an arrangement of coins and currency notes with visible denominations.
              Ensure coins and notes are distinct and arranged clearly.
              Question:
              From the image given,
              Total value of notes is ₹ |TEXT1|
              Total value of coins is ₹ |TEXT2|
              The total amount is ₹ |TEXT3|

            Example (with Diagram Prompt):
              Diagram Prompt:
              Draw three rectangles side-by-side, each with different shaded fractions.
              Ensure one rectangle has one-seventh of its area shaded.
              Question:
              Out of the three, rectangle [DROP1] represents one-seventh as its shaded area.
              The shaded area of rectangle 1 represents |TEXT1|.

        3. Fill in the Blank (Real-World Word Questions)
            Description:
              A fill-in-the-blank question framed using a real-life context described only in words.
              There is no image. Students translate the scenario into mathematical reasoning.
            Example:
              Arun has the following containers with different liquid capacities:
              (600 mL, 400 mL, 1 L, 500 mL, 2 L, 150 mL)
              How many of these containers can store half a litre of water (500 mL)?
              Answer = |TEXT1|
              The container with the least capacity is [DROP2]

            Example:
              The city with the smallest number of tourists is [DROP1]
              If the cities are arranged in descending order of tourists, then it follows the order [DROP2]

        4. Fill in the Blank (Real-World Image-Based Word Questions)
            Description:
              A real-life scenario where both words and an accompanying image are needed to answer.
              The image provides practical or spatial information (weights, positions, grids, shirts, etc.).
            Example (with Diagram Prompt):
              Diagram Prompt:
              Draw piles of T-shirts of different colors arranged in a 2×3 grid.
              Each pile contains a different quantity of shirts. The white shirt starts at Row 1, Column 1.
              Question:
              Which colour shirt will be in the right corner of the top row after the rearrangement?
              Answer: |TEXT1|
              In which row and column will the grey shirt be after the rearrangement?
              Row number = |TEXT2| and Column number = |TEXT3|

            Example (with Diagram Prompt):
              Diagram Prompt:
              Draw a 4×4 grid with four children (John, Liya, Mira, Noah) placed at different grid coordinates.
              Place a treasure box at Row 3, Column 2.
              Question:
              Who takes the most steps to reach the treasure box?
              Answer: [DROP1]
              How many more steps does Liya take compared to John?
              Answer: |TEXT2|

          ## FIB Type Selection Rule (CRITICAL)
          - In the TOPICS_SECTION, each question may optionally specify an "FIB Type".
          - If "FIB Type" is specified, you **MUST STRICTLY** generate a question that fits that specific definition and style.
          - If "FIB Type" is "Auto" or NOT specified, you must choose the most appropriate type based on the topic and grade level, ensuring variety across the set.

      </types_of_fib_questions>

      <diagram_prompt_guidelines>
          Diagram is optional (unless the topic inherently requires visual representation).
        - If included, give a **diagram prompt** (NOT the actual image).
        - If the topic inherently requires visual representation, then the diagram is mandatory.And the questions in the topic should be image based and everything should be related to the image .
        
        ### Diagram Prompt Guidelines:
        
        **Purpose**: Create exam-ready visual representations that support the question.
        
        **Content Requirements**:
          - It should describe the scene (NOT just "make 2 shapes with these lengths")
          - Must be an image suitable for putting in an exam paper
          - Should contain the scene with marking of values if needed
          - Create a realistic, data-based diagram that directly represents the situation
          - Visually match the setup (e.g., areas, objects, sections, or people mentioned) using relevant numerical values
          - Include only essential measurable details — such as quantities, time, cost, length, or rates — with proper units
          - Keep it simple, consistent, and self-contained
          - The diagram must reflect the same context as the question but present it through clear numbers or labeled visuals
        
        **Format Requirements**:
          - Do NOT give point-by-point descriptions
          - Use continuous narrative that properly defines everything
          - Write as a cohesive description, not a bulleted list
        
        ### Numerical Placement Rules:
          - **Diagram Prompt**: Introduce actual values, quantities, or relationships

        
        ### No-Repetition Rule:
          - Details or data mentioned in the context must NOT be repeated in the diagram
          - Each section must serve a distinct purpose:
              • Short Context = Real-life setup and qualitative description
              • Diagram = Visual/numerical representation of the setup
        
      </diagram_prompt_guidelines>

      <fib_subpart_specs>
        **CRITICAL - SUBPART STRUCTURE (MANDATORY COMPLIANCE)**:
    
        ⚠️ **STEP 1: CHECK THE CONFIGURATION ABOVE** ⚠️
        Look at the "FIB Sub-parts Configuration" section immediately above this instruction.
        - If it shows "Question X: N sub-parts - i) DOK..., ii) DOK...", that question REQUIRES roman numeral subparts
        - If a question is NOT listed in the configuration, it should be a single-part question (no subparts)
        
        ⚠️ **STEP 2: FOR QUESTIONS WITH SUB-PARTS LISTED** ⚠️
        You MUST follow this structure EXACTLY:
        
        1. **Roman Numeral Labels (MANDATORY)**:
          - Use i), ii), iii), iv), v) for each subpart
          - DO NOT use a), b), c) or 1), 2), 3)
          - DO NOT create a single question without subparts when subparts are specified
        
        2. **Subpart Requirements**:
          - Each subpart (i, ii, iii, etc.) must have its own blank(s)
          - Each subpart must match its specified DOK, Marks, and Taxonomy from the configuration
          - All subparts belong to ONE continuous scenario/context
          - Each subpart tests a different aspect of the same concept
        
        3. **Marker Numbering (CRITICAL)**:
          - Number markers sequentially across ALL subparts: |TEXT 1|, |TEXT 2|, |TEXT 3|, etc.
          - Example: If subpart i) uses |TEXT 1|, then subpart ii) starts with |TEXT 2|
          - DO NOT restart numbering for each subpart
      
      </fib_subpart_specs>

      <solution_generation>
            [Provide step-by-step solution showing how to arrive at the correct answer. Include all reasoning and calculations and the mark split.]

       </solution_generation>

       <key_idea rules>
        KEY IDEA

          1. What kind of problems these are  
            Explain simply what students are trying to find in such problems.

          2. Core idea behind these problems  
            Teach the main idea from the beginning in very simple terms.

          3. Why this idea works  
            Explain the logic in real understanding, not as a rule to memorize.

          4. General step-by-step method  
            Step 1:  
            Step 2:  
            Step 3:  
            Step 4:  

          5. Common mistakes students make  
            Mention at least two mistakes and why they happen.

          6. Tips to avoid these mistakes  
            Give practical student-friendly advice.

          The explanation must naturally include the rule or principle used, but blended into teaching — not as a separate definition.

          Do not include anything else.

      </key_idea rules>

      <question_cognitive_indirectness_rule>
              All questions must be grade-appropriate in mathematical level,
              but the required relationship must NOT be directly visible or immediately usable.

              The student should NOT be able to answer by applying one property immediately after reading the question.

              Instead, the question must require the student to FIRST interpret the diagram
              and identify hidden or intermediate relationships before using the target concept.

              This means:

              • The required angles should not be labelled in an obvious pair.
              • The needed relationship should be embedded among other angles.
              • An intermediate angle or relation must be recognized before solving.
              • The question must require interpretation BEFORE calculation.

              Direct question patterns that are NOT allowed:
              ❌ “Find x if these two angles form a linear pair”
              ❌ “Name the vertically opposite angles”
              ❌ “If l || m find angle ABC”
              ❌ Any question where the used property is explicitly stated or visually isolated.

              Allowed question style:
              ✔ Student must determine WHICH angles are related first.
              ✔ Student must locate the correct relationship from multiple possibilities.
              ✔ Student must derive an intermediate angle before the final step.
              ✔ The diagram contains extra information not immediately useful.

              The mathematics must remain Grade level,
              but the path to the concept must require recognition, interpretation, and selection.
              If a student can identify the required property within 5 seconds of reading the question,
              the question is too direct and must be redesigned.

      </question_cognitive_indirectness_rule>

            
      <question_enhancement_idea>

        Use textbook-style geometric structure as inspiration (clarity, multiple relations, meaningful layout), but DO NOT copy any figure. Reconstruct a new configuration that shows layered relationships (intersections, parallels, transversals, angle links) rather than a single simple shape.
        Each diagram must support reasoning across multiple connected elements, and every question must depend on these structural relationships — not just direct measurement or one-step observation.
        Analyse the exercise of each topic so that you can make better questions. Better figures, common figures are not required try to make outside the box figures which is realastic

      </question_enhancement_idea>

       <DOK_level_explanation>
            COGNITIVE DEPTH & OLYMPIAD REASONING MODE (MANDATORY)

            All questions must be grade-appropriate in content,
            but non-direct and structure-based in reasoning.

            The required concept must NOT be immediately usable.
            Students must interpret the situation, identify relationships,
            and use intermediate reasoning before reaching the answer.

            --------------------------------
            DOK STRUCTURAL DEFINITIONS
            --------------------------------

            DOK 1 — Recognition
            • Identify, label, classify, or read directly.
            • No calculation.
            • No inference chain.

            DOK 2 — Sequential Application
            • Solve using TWO or more connected steps.
            • Must require an intermediate result.
            • Must combine different pieces of information.

            DOK 3 — Constraint-Based Reasoning
            • A condition or claim must be evaluated.
            • Student must analyse relationships across the whole structure.
            • Answer must be justified by consistency, necessity, or elimination.
            • Requires interpretation before solving.

            --------------------------------
            OLYMPIAD STRUCTURE RULES
            --------------------------------

            • The solution path must not be obvious.
            • Multiple elements must interact (not a single relation).
            • Some information should be indirect or distracting.
            • The answer must be forced by constraints, not direct substitution.
            • At least one intermediate inference must be necessary.

            --------------------------------
            DIRECTNESS CHECK (MANDATORY)
            --------------------------------

            If the required method is obvious immediately,
            or a single direct step gives the answer,
            the question must be redesigned.

                  
            - whatever you are thinking to make question make it one lvel up so that it will be in proper dok level
      </DOK_level_explanation>
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.

      </what_not_to_do>
    </requirements>
    <output_format>
       Return JSON: 
      {
        "questions": [
          {
            "question_id": "Q1",
            "question_text": "...",
            "correct_answer": "correct answer for each blanks [|TEXT n|or |DROP N|]", 
            "solution": "Brief explanation...",
            "key_idea": "Key concept..."
            
          },
          // .. next question in same format
        ]
      }
    </output_format>
  </writer_generation>


a&b_math_core: |
  <math_core_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <chapter>{{Chapter}}</chapter>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
      The user needs the following specific questions designed:
      {{Question_Specific_Requirements}}
    </design_requirements>
    
    <task>  
      You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

      STRICT RULES:  
      - Do NOT write a story.  
      - Do NOT write a scenario.  
      - Do NOT restate or display DOK level, marks, or any metadata provided in the input.  
      - ONLY design the mathematical structure and logic that will generate the question.  
      - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

      For EACH question listed in <design_requirements>, define:

      1. **Abstract Math Structure**  
        - The underlying mathematical framework (e.g., Right Triangle, Linear Pair, Quadratic Curve, etc.)  
        - Must be deep enough to support the required reasoning complexity.

      2. **Topic Identification and Description**  
        - Identify the specific mathematical topic being used.  
        - Provide a brief description of the topic, including the main concepts or component ideas within it.

      3. **Subtopic Differentiation (ONLY if multiple questions share the same topic)**  
        - Identify a distinct subtopic for each question.  
        - Subtopics must be unique across questions.  
        - Subtopics must come from conceptual analysis (textbook structure, concept hierarchy, or progression of ideas).

    </task>

    <requirements>

      1. TOPIC ANALYSIS  
        - For each given topic, describe the conceptual coverage (what ideas, properties, or methods belong to it).  
        - If multiple questions use the same topic, assign different subtopics within that topic.

      2. STRUCTURAL COMPLEXITY  
        - The math structure must be sufficiently rich to support the required reasoning level.  
        - The structure must naturally produce the intended mathematical task.

      3. ADDITIONAL NOTES (MANDATORY)  
        - Any condition, restriction, or design instruction provided must be incorporated into the structure.

      4. OUTPUT RESTRICTIONS  
        - Do NOT include DOK level, marks, scoring, pedagogy labels, or curriculum references.  
        - Only output structural mathematical design.

    </requirements>
    
    <output_format>
      Return a valid JSON object:
      {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name and its description",
            ...
          },
          ...// next object(question) with same structure
        ]
      }
    </output_format>
  </math_core_generation>

a&b_writer: |
  <writer_generation>
    <context>
       <grade>{{Grade}}</grade>
       <requirements>{{Question_Requirements}}</requirements>
       <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    <math_blueprint>
       {{MATH_CORE_DATA}}
    </math_blueprint>
    <task>
       You are a teacher preparing Assertion–Reason–type higher-order questions for Mathematics for Final exams. The questions as well as the solution should be of higher quality.
       Follow all the rules and structure precisely.
    </task>

    <requirements>
      <a&r_structure>
        
        - Present the Assertion–Reason question clearly.
        - Mention the Topic in brackets.
        - Start with the exact phrase: "A statement of assertion (A) is followed by a statement of reason (R)."
        - Place Assertion and Reason on separate lines with proper spacing.
        - End with the exact phrase: "Which among the following options is true regarding the given statements?"
        - Clearly state the Correct Option.
        - Clearly explain the solution.
        - Need to mention Distractor Analysis.
        - Clearly state the key idea.
        - Dont give Hints or clues becasue this question is for examination

        Example Structure:

        Topic: Nature of Roots

        A statement of assertion (A) is followed by a statement of reason (R).
        Assertion (A): The quadratic equation x² + 4x + 5 = 0 has no real roots.
        Reason (R): The discriminant D of a quadratic equation ax² + bx + c = 0 is given by D = b² − 4ac.
        Which among the following options is true regarding the given statements?
        
        **Options:**

        A) Both Assertion (A) and Reason (R) are true, and Reason (R) explains Assertion (A).
        B) Both Assertion (A) and Reason (R) are true, but Reason (R) does not explain Assertion (A).
        C) Assertion (A) is true, but Reason (R) is false.
        D) Assertion (A) is false, but Reason (R) is true.

          Correct Option: B

      </a&r_structure>

      <options>
      
        A) Both Assertion (A) and Reason (R) are true, and Reason (R) explains Assertion (A).
        B) Both Assertion (A) and Reason (R) are true, but Reason (R) does not explain Assertion (A).
        C) Assertion (A) is true, but Reason (R) is false.
        D) Assertion (A) is false, but Reason (R) is true.

        - The order of options shouldnt be changed 

        ANSWER DISTRIBUTION RULE (UPDATED)

        Ensure the final answer key across all questions follows this distribution:

        - **20%** of questions → **Correct Option A**
        - **30%** of questions → **Correct Option B**
        - **25%** of questions → **Correct Option C**
        - **25%** of questions → **Correct Option D**

          FOR EG : 10 QUESTION 
          then  A=2, B=3, C=2, D=3
          Total must always equal {{TOTAL_QUESTIONS}}.
          
      </options>
      <solution>
        - It shoudnt be too long.
        - Explain step-by-step so an average student can follow clearly.
        - Dont be vague or ambiguous.
        - it should be continuous
        - Naturally include:
          - Whether the Assertion is true or false, with reasoning or calculation
          - Whether the Reason is true or false, with the correct concept or formula
          - The logical relationship between A and R
          - Clear justification for why the correct option is correct
        - Use equations, examples, or properties where needed.
        - Keep the language student-friendly and clear.
        - Names should be simple and commonly used  (eg : Jack	Anna  Ryan	Emily	Sam	Maria	John		)
        
        DO NOT use academic or classroom settings.
        This means NO:
        - teacher, student, class, quiz, test, homework, assignment, exam, studying

        
      </solution>

      <distractor_analysis>
          for every assertion_reasoning question a Distractor Analysis is compulsory.

          1. Distractor Design Rule
            Each incorrect option MUST be intentionally framed using exactly ONE identifiable mathematical error type. 
            Distractors must reflect realistic student mistakes and must not be random, vague, or purely eliminative.
            Do NOT mix multiple error types within a single option.
            - You should only select error type from the list provided below ( 4 type of errors)
            - You should not repeat the same error type for all options.
            - Do not use phrases such as “the student might think” or “the student might choose” in the distractor analysis, because the explanation is addressed to the learner directly.	

          Types of error that needs to be used in distractor analysis
            A. Conceptual Error  
              Definition: Arises from an incorrect understanding of a mathematical concept, rule, or property, leading to the wrong method or idea being applied.  
              Nature: Misunderstanding what concept should be used.  
              Use in distractors: Target common misconceptions.
              eg : Examples:
                  • Believing (a+b)^2 = a^2 + b^2
                  • Using the area formula when the perimeter is required
                Use in distractors:
                  Targets common misconceptions.

            B. Computational Error  
              Definition: Occurs when the correct concept and method are chosen, but a mistake is made during arithmetic or algebraic computation.  
              Nature: Careless calculation or manipulation error.  
              Use in distractors: Capture calculation-based mistakes.
              Examples:
                • 7 \times 8 = 54
                • Sign error: -4 + 6 = -10
                • Incorrect simplification: \frac{6}{3} = 1
              Use in distractors:
                Captures careless calculation mistakes.
            C. Communicational Error  
              Definition: Occurs when the student understands the mathematical concept and solution
              but expresses the answer using incorrect notation, symbols, format, or units.  
              Nature: Error in mathematical communication or representation.  
              Use in distractors: Test notation, symbols, units, and expression clarity.

              Examples:
                Writing x = 2 instead of x ± 2
                Writing x = 3 instead of x ≥ 3
                Giving 30 instead of 30 km/h
                Writing x = 1,2 instead of {1,2}

                Use in distractors:
                Tests mathematical communication and notation skills.
            D. Comprehension Error    
              Definition: Occurs when the student correctly understands the mathematical concepts
              but misreads, overlooks, or ignores explicit instructions, conditions, or keywords
              in the question.  
              Nature: Error in interpreting what is asked, not in understanding mathematics.
              Use in distractors: Identify reading comprehension and instruction-following weaknesses.
              Examples:
                • Finding the area when the question asks for perimeter
                • Ignoring words like “number of solutions”, “at most”, “except”
                • Solving for x when the question asks for the value of an expression
                Use in distractors:
                  Identifies weaknesses in reading comprehension and attention to detail.
          -   Distractor analysis should explain the reasoning abstractly, without referencing textbook pages, sections, or verbatim excerpts.   
            Error-Type Classification Gate (MANDATORY)

              Before assigning an error type to any distractor, apply this gate:

              1. If the student’s mistake would STILL occur even if the question were reworded or simplified,
                then it is NOT a Comprehension Error.

              2. Comprehension Error may be used ONLY when:
                - the student ignores or misreads an explicit instruction, keyword, or condition
                - AND the mathematical concept itself is correctly understood

              3. Any misunderstanding of:
                - sign (positive / negative / zero)
                - number properties
                - definitions
                - term meaning (e.g., “negative”, “odd”, “multiple”)
                MUST be classified as a Conceptual Error, not Comprehension.
              4. No two option should be of same error type ( there should be validation fot that)
            ### Error-Type Decision Table (MANDATORY)

          | Observed Student Mistake | Correct Error Type |
          |--------------------------|-------------------|
          | Thinks 0 is negative | Conceptual Error |
          | Uses wrong formula | Conceptual Error |
          | Ignores word like “except”, “first”, “at most” | Comprehension Error |
          | Solves correctly but answers a different quantity | Comprehension Error |
          | Arithmetic slip with correct method | Computational Error |
          | Wrong units / notation / symbol | Communicational Error |

        IMPORTANT EXCLUSION:
          If the error arises from misunderstanding a mathematical definition, property,
          classification, or meaning (e.g., sign of a number, term meaning, formula components),
          it MUST be classified as a Conceptual Error, not Comprehension.

          For distractor analysis, there are four predefined error types. When constructing a set of answer options, select any three of these error types first. Each of the three incorrect answer choices must correspond to one of the selected error types, with no repetition of error types across the distractors. After finalizing which three error types will be used, design the three incorrect options to accurately reflect those specific errors. Do not generate distractors first and then assign error labels afterward; the selection of error types must precede the creation of incorrect options.

          **OUTPUT FORMAT: The distractor analysis MUST be presented as a markdown table with two columns: "Option & Error Type" and "Misconception"**. The “Option & Error Type” column MUST follow the format: "Option Letter – Error Type" (e.g., "B – Conceptual Error").

          For each incorrect option, follow this exact explanation structure:

          **First Sentence — State the Student’s Belief**
          - Begin with: “You selected this option because you believed that …”
          - Then restate the interpretation of the option the student selected:
            • Option A → A true, R true, and R explains A  
            • Option B → A true, R true, but R does not explain A  
            • Option C → A true, R false  
            • Option D → A false, R true  

          **Second Step — Why the Student Chose It**
          - After the first sentence, continue with: “This may have happened because …”
          - Explain the misconception or mistake that might have led the student to choose this option.

          **Third Step — Correct the Misunderstanding**
          - Continue with: “However, this is incorrect because …”
          - Explain the actual truth values of A and R.
          - Clearly show why the student's belief does not match the correct reasoning.

          **Fourth Step — Final Clarification**
          - End with: “So this option cannot be the correct answer.”  

        - Do not explicitly say "Why the Student Chose It" , "Correct the Misunderstanding" or "Final Clarification".All the sentences should be in the same paragraph.

          **Important Rules:**
          - Do NOT say: “You correctly identified that…”  
          - Do NOT partially praise the student unless it matches the option's meaning.  
          - Always align the explanation with the TRUE/FALSE nature of A and R.
          - Keep the explanation simple, student-friendly, detailed, and grammatically correct.
          - Use equations or symbols when needed.
          - Maintain a smooth flow between sentences
        
      </distractor_analysis>

      <key_idea rules>
        KEY IDEA
          
          1. What kind of problems these are  
          Explain in simple words what these questions are generally asking the student to understand or find.

          2. Core idea behind these problems  
          Explain the main idea from the beginning, as if the student has zero background knowledge.

          3. Why this idea works  
          Explain logically why this method makes sense in real understanding, not just as a rule to memorize.
      
          4. General step-by-step method  
          Write this as clearly numbered steps:
          Step 1:  
          Step 2:  
          Step 3:  
          Step 4:  

          Each step must describe ONE clear action the student should take.

          5. Common mistakes students make  
          Mention at least two common mistakes and explain why students make them.

          6. Tips to avoid these mistakes  
          Give simple, practical tips written directly for a student.
          **- Do NOT explicitly break the explanation into “What kind of problems”, “Core idea”,"Common mistakes students make  " or “Why this works”.
          Do NOT restate or refer to the given question (Why this idea works .. etc ). **

          7. The KEY IDEA must naturally include the rule or principle
          used in solving. The explanation must clearly show what the
          rule says and how it changes the solution process.
          Do not separate it into a special section. Blend it into the teaching.

          --------------------------------------------------

          QUALITY CHECK (MANDATORY):
          - Minimum length: 4-5 full sentences.
          - The explanation must be reusable for any similar problem.
          - If the explanation sounds suitable for a strong student, rewrite it to be simpler.


        Structure:

        1. Start with a brief conceptual explanation related to the topic itself. 
          It should describe the idea using simple language, and may include short examples if they help (e.g., π or √2 for irrational numbers). 
          This explanation should clarify the underlying concept students must know to judge truth or falsity.

        2. After the concept explanation, give guidance on how to analyze Assertion and Reason parts by following these steps, using bullet points:

          Step 1: Check truth of the Assertion
          - Compare the statement to the concept explained above
          - Decide if it is true or false based on definitions, properties, or rules

          Step 2: Check truth of the Reason
          - Evaluate if the reason is itself a correct statement
          - Check if it matches known facts or properties of the topic

          Step 3: Check relationship between Assertion and Reason (only if both are true)
          - Decide whether the Reason actually explains why the Assertion is true
          - See if the Reason provides a logical cause or justification for the Assertion

          Step 4: Evaluate the options
          - Based on truth values and logical relationship, choose from the standard options (Both true and explains, Both true but does not explain, Assertion true Reason false, Assertion false Reason true)

        3. Key Idea must be clear, practical, and apply to any similar question on the topic. 
          It should help students understand how to use the concept to evaluate Assertion–Reason statements in future questions.


      </key_idea rules>


      <Strict_rules_for_a&r>
        
        -  **Ban trivial true/false assertions:**  
          Assertions must require reasoning, not simple factual recall.

        -  **Stick strictly to the given grade, subject, and chapter:**  
          No out-of-syllabus or higher-level concepts.

        -  **Reason must be independent (not a paraphrase):**  
          The Reason must introduce a separate mathematical idea, not repeat the Assertion.

        -  **Assertion and Reason must be from the same mathematical domain:**  
          Both must relate to the same area of math (algebra with algebra, geometry with geometry).

        -  **Reason must be logically relevant:**  
          Even if not the correct explanation, it must still relate meaningfully to the Assertion.

        -  **Ensure conceptual variety:**  
          Each question must use a different type of reasoning or mathematical concept.

        -  **Use only mathematics, no physics/chemistry contexts:**  
          Do not use velocity, pressure, force, acids, etc. Only math concepts.

        -  **Use correct mathematical notation:**  
          All symbols, expressions, and equations must be valid and formatted correctly.
    
        -  **Be original, not copied or rephrased from textbooks.**  
        - Include mathematically valid reasoning and logical relationships between assertion and reason.
        - Each question must be unique and not a repetition or rewording of another.
        - Need to be DOK 3 (questions needs to be hard )
        - Should be from topics mentioned in the specified topics
        - Each question should go beyond recall or simple application, requiring reasoning, analysis, or multi-step problem-solving. If a question seems too straightforward after paraphrasing, revise it to increase complexity — for example, by adding conditions, comparisons, justifications, or requiring explanation of reasoning.
    - (if the topic requires to use the pdf ) The attached PDF contains subtopics of the topics (which will be clearly defined). If you are able to correctly identify, use all the subtopics of each topic from the PDF to generate questions.
      </Strict_rules_for_a&r>
       <question_cognitive_indirectness_rule>
              All questions must be grade-appropriate in mathematical level,
              but the required relationship must NOT be directly visible or immediately usable.

              The student should NOT be able to answer by applying one property immediately after reading the question.

              Instead, the question must require the student to FIRST interpret the diagram
              and identify hidden or intermediate relationships before using the target concept.

              This means:

              • The required angles should not be labelled in an obvious pair.
              • The needed relationship should be embedded among other angles.
              • An intermediate angle or relation must be recognized before solving.
              • The question must require interpretation BEFORE calculation.

              Direct question patterns that are NOT allowed:
              ❌ “Find x if these two angles form a linear pair”
              ❌ “Name the vertically opposite angles”
              ❌ “If l || m find angle ABC”
              ❌ Any question where the used property is explicitly stated or visually isolated.

              Allowed question style:
              ✔ Student must determine WHICH angles are related first.
              ✔ Student must locate the correct relationship from multiple possibilities.
              ✔ Student must derive an intermediate angle before the final step.
              ✔ The diagram contains extra information not immediately useful.

              The mathematics must remain Grade level,
              but the path to the concept must require recognition, interpretation, and selection.
              If a student can identify the required property within 5 seconds of reading the question,
              the question is too direct and must be redesigned.

      </question_cognitive_indirectness_rule>

      <Dok_3>

        DOK 3 (Reasoning): Focuses on multi-step problem-solving requiring justification of answers, analyzing relationships, interpreting results, and drawing conclusions from the given scenario or data.

        **IMPORTANT: Adjust the complexity of DOK 3 questions to be appropriate for {{Grade}} level.**
        - For lower grades, focus on simpler reasoning and direct application.
        - For higher grades, require more abstract reasoning and multi-step proofs.
        - 
        • A condition or claim must be evaluated.
        • Student must analyse relationships across the whole structure.
        • Answer must be justified by consistency, necessity, or elimination.
        • Requires interpretation before solving.
        
      </Dok_3>
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <taxonomy>
        **Taxonomy Lock Rule**
        - For every question type, the user will explicitly specify:
          - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
          - DOK level
          - Marks
        - You MUST use **only the taxonomy provided for that question type**.
        - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
        - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.

        
      </taxonomy>

      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.

      </what_not_to_do>
      
    </requirements>
    <output_format>
       Return JSON: 
       {
        "questions": [
          {
            "question_id": "Q1",
            "question_text": "...",
            "options": {
              "A": "...",
              "B": "...",
              "C": "...",
              "D": "..."
            },
            "correct_option": "A/B/C/D",
            "solution": "Brief explanation...",
            "distractor_analysis": "Distractor Analysis...",
            "key_idea": "Key concept..."
            
          },
          // .. next question in same format
        ]
      }
    </output_format>
  </writer_generation>


multipart_math_core: |
  <math_core_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <chapter>{{Chapter}}</chapter>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
      The user needs the following specific questions designed:
      {{Question_Specific_Requirements}}
    </design_requirements>
    
    <task>  
      You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

      STRICT RULES:  
      - Do NOT write a story.  
      - Do NOT write a scenario.  
      - Do NOT restate or display the Topic name.  
      - Do NOT display DOK level, marks, or any metadata provided in the input.  
      - ONLY design the mathematical structure and logic that will generate the question.  
      - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

      For EACH question listed in <design_requirements>, define:

      1. **Abstract Math Structure**  
        - The underlying mathematical framework (e.g., Linear Pair, System of Equations, Right Triangle with altitude, etc.)  
        - Must be deep enough to logically support all required sub-questions.

      2. **Sub-question Logic**  
        - Explain how the structure supports multiple sub-questions in a progressive or connected way.  
        - The structure must naturally allow increasing reasoning complexity.

      3. **Sub-question Breakdown**  
        For EACH sub-question provide:
        - **Subtopic (unique — cannot repeat across sub-questions)**  
        - **Brief Description** explaining what mathematical idea or operation is being tested.

    </task>

    <requirements>

      1. SUBTOPIC SELECTION  
        - Identify different subtopics from within the given topic domain.  
        - Each sub-question MUST use a distinct subtopic.  
        - Subtopics must come from concept analysis (textbook, syllabus progression, or logical concept hierarchy).

      2. STRUCTURAL COMPLEXITY  
        - The math structure must be sufficiently rich to support all sub-questions logically.  
        - Sub-questions must emerge naturally from the same structure (not disconnected tasks).

      3. ADDITIONAL NOTES (MANDATORY)  
        - If any constraint, condition, value restriction, or design instruction appears in Additional Notes, it MUST be incorporated into the structure and sub-question logic.

      4. OUTPUT RESTRICTIONS  
        - Do NOT include:DOK level, marks, scoring, pedagogy labels,explanation of curriculum alignment, or **how to make questions**.  
        - Only output structural mathematical design.

    </requirements>
    
    <output_format>
      Return a valid JSON object:
      {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name and its description",
            ...
          },
          ...// next object(question) with same structure
        ]
      }
    </output_format>
  </math_core_generation>

multipart_writer: |
  <writer_generation>
    <context>
       <grade>{{Grade}}</grade>
       <requirements>{{Question_Requirements}}</requirements>
       <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    <math_blueprint>
       {{MATH_CORE_DATA}}
    </math_blueprint>
    <task>
       You are a teacher preparing Multipart type higher-order questions for Mathematics for Final exams. The questions as well as the solution should be of higher quality.
       Follow all the rules and structure precisely.
    </task>

    <requirements>
      <multipart_question_structure>
        - There is NO detailed scenario paragraph.
        - A **short 1–2 line direct context** is allowed (see Context Rule), but NO storytelling.
        - **IMPORTANT**: The context must be completely free of "classroom" or "learning" framing (e.g., no "students learning", "teacher asking").
        - Each sub-part must directly test mathematical computation, reasoning, or application.
        - The question must NOT require outside information; everything must be solvable using the given prompt and diagram.
        - Every question must follow the specific sub-part configuration provided for it in the TOPICS section, with all sub-parts from the same subtopic.
        - **Final Answer Rule**: The expected answer for each sub-part must be a **single word, phrase, or number**. Do NOT use full sentences for the final answer (eg:  dont use definition of a theorem or a formula).
        - Each subtopic must produce one complete question.
        - Its an NCERT syllabus based question and solution.
        - Should not include equations from physics or chemistry( like force, work etc), everything should be mathematical
      </multipart_question_structure>

      <question_type>
         1. Multi-Part (Number Based)
          Description:
            A multi-part question involving more than one sub-question, using only numbers, units, or symbolic information.
            There is no image and no real-world scenario. Each sub-question builds on quantitative reasoning.
          Examples:
            The table below compares two tables by subtracting the one product from the other.
            Notice how the product difference forms a pattern that increases by the same amount each step.
            Use this pattern to find the missing values P and R.

            Observe the addition given in the table:
            T.Th Th H T O
            3  8  A  7  6
            4  9  8  B
            +         4  5  6
            4  3  C  2  D

            The digits A and B are chosen so that:
            A has the largest possible value, and
            B has the smallest possible value,
            while keeping the addition correct.

            1. What is the value of B?
            Prefix: Answer

            2. What is the value of A?
            Prefix: Answer

        2. Multi-Part (Image Based)
          Description:
            A multi-part question where the information needed to answer is obtained from images, diagrams, or visual patterns.
            There is no real-world contextual story. Visual interpretation drives the reasoning.
          Example (with Diagram Prompt):
            Diagram Prompt:
            Provide an incomplete symmetric shape on a dot grid, where the final completed shape can be inferred.
            Ensure symmetry is visible once completed.
            Questions:
            i. How many sides does the completed shape have?
            ii. How many lines of symmetry does the completed shape have?

          Example (with Diagram Prompt):
            Diagram Prompt:
            Draw overlapping circles forming coloured regions. Highlight yellow petal-shaped overlaps and a region with maximum overlap.
            Questions:
            i. Look at the yellow petal-shaped regions in the diagram. How many circles overlap to create each yellow region?
            ii. Which coloured region is formed by the overlap of the greatest number of circles?

          Example (with Diagram Prompt):
            Diagram Prompt:
            Draw a circle with two diameters intersecting at right angles. Connect the endpoints of the diameters in order.
            Questions:
            i. What type of quadrilateral is formed when the endpoints of the two diameters are joined?
            ii. How many of the angles in this quadrilateral are right angles?

        3. Multi-Part (Real-World Word Questions)
          Description:
            A multi-part question framed entirely in real-world narrative using words.
            There is no diagram. The scenario involves realistic quantities, objects, or activities.
          Examples:
            The library has 22 shelves of fiction books and 14 shelves of non-fiction books.
            Each shelf can hold 132 books.
            Questions:
            How many fiction books are there in the library?
            What is the total number of books in the library?

        4. Multi-Part (Real-World Image-Based Word Questions)
          Description:
            A multi-part question involving a real-world context supported by an image.
            Both the scenario (words) and the visual are required to answer.
          Example (with Diagram Prompt):
            Diagram Prompt:
            Draw a multi-shape floor pattern using regular polygons (triangle, square, hexagon, etc.) touching edge-to-edge.
            Questions:
            i. How many different types of regular shapes are there in this pattern?
            ii. Name the shape that shares edges with the maximum number of different shapes.
            iii. How many more square tiles are needed to cover the remaining edges of the yellow tiles?

          Example (with Diagram Prompt):
            Diagram Prompt:
            Provide an image showing a tilted parallelogram-shaped frame (opposite sides equal, slanted corners).
            Below it show a modified version where all angles become right angles while opposite sides remain equal.
            Questions:
            i. What is the name of the shape Ben designed for the light frame?
            ii. Later, what new shape did he create after adjusting the corners?

        ## Multi-Part Type Selection Rule (CRITICAL)
        - In the TOPICS_SECTION, each question may optionally specify an "Multi-Part Type".
        - If "Multi-Part Type" is specified, you **MUST STRICTLY** generate a question that fits that specific definition and style.
        - If "Multi-Part Type" is "Auto" or NOT specified, you must choose the most appropriate type based on the topic and grade level, ensuring variety across the set.

          **Important**
            - All sub-parts must belong to one continuous scenario.
            - one subpart should lead to other subparts.
            - The storyline must remain the same across (a), (b), (c).
            - However, the mathematical values, calculations, and results of earlier sub-parts do NOT have to be needed to solve later sub-parts.
            - Continuity applies to the story context, not to the numerical output.
            Each sub-part must be solvable independently while still belonging to the same scenario.

            Eg of a non continuous scenario and question : 
              A long ribbon is being used for decorations.
              (a) A ribbon is 9/12 metres long. If a piece measuring 5/12 metres is cut from it, what is the length of the remaining ribbon? (Topic: Fractions, Subtopic used: Fraction subtraction) DOK: 1, Marks: 1.0, Taxonomy: Remembering
              (b) A jug contains 6/8 litres of juice. You need to pour out some juice so that exactly 1/4 litre remains in the jug. To do this, you only have two measuring cups of sizes 1/8 litre and 1/4 litre. Find the combination of cups to use to pour out the required amount in the fewest number of pours. (Topic: Fractions, Subtopic used: Fraction subtraction) DOK: 3, Marks: 1.0, Taxonomy: Understanding
              
              Issues with the example : 

              - The scenario shifts from ribbon length to jug of juice.
              - The objects, activities, and context are entirely different.
              - This violates the rule that (a) and (b) must remain within one scenario.
                      
            Eg of a continuous scenario and question : 
              A school is organizing its annual sports day with 48 students participating.
              (a) If 1/6 of the students are participating in the relay race, how many students are in the relay race? (Topic: Fractions, Subtopic used: Fraction multiplication) DOK: 1, Marks: 1.0, Taxonomy: Remembering
              (b) In the same group of 48 students, 1/3 signed up for high jump and 1/4 signed up for long jump. If 8 students signed up for only high jump, find the number of students who signed up for both high jump and long jump. (Topic: Fractions, Subtopic used: Fraction multiplication) DOK: 3, Marks: 1.0, Taxonomy: Understanding
            
            why is this a continuous scenario?
            - Same group of 48 students.
            - Same event (sports day context).
            - Scenario flows correctly.
     
      
      </question_type>
          - Diagram is optional (unless the topic inherently requires visual representation).
          - If included, give a **diagram prompt** (NOT the actual image).
          - If the topic inherently requires visual representation, then the diagram is mandatory.And the questions in the topic should be image based and everything should be related to the image .
          
          ### Diagram Prompt Guidelines:
          
          **Purpose**: Create exam-ready visual representations that support the question.
          
          **Content Requirements**:
            - It should describe the scene (NOT just "make 2 shapes with these lengths")
            - Must be an image suitable for putting in an exam paper
            - Should contain the scene with marking of values if needed
            - Create a realistic, data-based diagram that directly represents the situation
            - Visually match the setup (e.g., areas, objects, sections, or people mentioned) using relevant numerical values
            - Include only essential measurable details — such as quantities, time, cost, length, or rates — with proper units
            - Keep it simple, consistent, and self-contained
            - The diagram must reflect the same context as the question but present it through clear numbers or labeled visuals
          
          **Format Requirements**:
            - Do NOT give point-by-point descriptions
            - Use continuous narrative that properly defines everything
            - Write as a cohesive description, not a bulleted list
          
          ### Numerical Placement Rules:
            - **Diagram Prompt**: Introduce actual values, quantities, or relationships
            - **Sub-Questions**: Use those numbers for reasoning, comparison, and problem-solving
          
          ### No-Repetition Rule:
            - Details or data mentioned in the context must NOT be repeated in the diagram
            - Details or data in the diagram must NOT be repeated in the sub-questions
            - Each section must serve a distinct purpose:
                • Short Context = Real-life setup and qualitative description
                • Diagram = Visual/numerical representation of the setup
                • Sub-questions = Logical and mathematical reasoning based on both


      <diagram_prompt>
        - Diagram is optional (unless the topic inherently requires visual representation).
        - If included, give a **diagram prompt** (NOT the actual image).
        - If the topic inherently requires visual representation, then the diagram is mandatory.And the questions in the topic should be image based and everything should be related to the image .
        
        ### Diagram Prompt Guidelines:
        
        **Purpose**: Create exam-ready visual representations that support the question.
        
        **Content Requirements**:
          - It should describe the scene (NOT just "make 2 shapes with these lengths")
          - Must be an image suitable for putting in an exam paper
          - Should contain the scene with marking of values if needed
          - Create a realistic, data-based diagram that directly represents the situation
          - Visually match the setup (e.g., areas, objects, sections, or people mentioned) using relevant numerical values
          - Include only essential measurable details — such as quantities, time, cost, length, or rates — with proper units
          - Keep it simple, consistent, and self-contained
          - The diagram must reflect the same context as the question but present it through clear numbers or labeled visuals
        
        **Format Requirements**:
          - Do NOT give point-by-point descriptions
          - Use continuous narrative that properly defines everything
          - Write as a cohesive description, not a bulleted list
        
        ### Numerical Placement Rules:
          - **Diagram Prompt**: Introduce actual values, quantities, or relationships
          - **Sub-Questions**: Use those numbers for reasoning, comparison, and problem-solving
        
        ### No-Repetition Rule:
          - Details or data mentioned in the context must NOT be repeated in the diagram
          - Details or data in the diagram must NOT be repeated in the sub-questions
          - Each section must serve a distinct purpose:
              • Short Context = Real-life setup and qualitative description
              • Diagram = Visual/numerical representation of the setup
              • Sub-questions = Logical and mathematical reasoning based on both

      </diagram_prompt>

      <key_idea>
          You must write a KEY IDEA meant for a weak or struggling student.

          ASSUME:
          - The student has NEVER seen this topic before.
          - The student does NOT know any technical or mathematical terminology.

          HARD RULES (DO NOT VIOLATE):
          - Do NOT mention any numbers, symbols, variables, equations, diagrams, or values from the question.
          - Do NOT use advanced or textbook-style language.
          - Do NOT write in a single flowing paragraph.
          - Do NOT skip or merge sections.
          - The explanation must work for ANY similar question of this type.

          LANGUAGE RULES:
          - Use very simple, school-level English.
          - Prefer short sentences.
          - If a word sounds technical, explain it immediately or avoid it.
          - Write as if you are teaching a confused student one-on-one.

          --------------------------------------------------

          REQUIRED STRUCTURE (WRITE EXACTLY IN THIS ORDER):

          KEY IDEA

          1. What kind of problems these are  
          Explain in simple words what these questions are generally asking the student to understand or find.

          2. Core idea behind these problems  
          Explain the main idea from the beginning, as if the student has zero background knowledge.

          3. Why this idea works  
          Explain logically why this method makes sense in real understanding, not just as a rule to memorize.
      
          4. General step-by-step method  
          Write this as clearly numbered steps:
          Step 1:  
          Step 2:  
          Step 3:  
          Step 4:  

          Each step must describe ONE clear action the student should take.

          5. Common mistakes students make  
          Mention at least two common mistakes and explain why students make them.

          6. Tips to avoid these mistakes  
          Give simple, practical tips written directly for a student.
          **- Do NOT explicitly break the explanation into “What kind of problems”, “Core idea”,"Common mistakes students make  " or “Why this works”.
          Do NOT restate or refer to the given question (Why this idea works .. etc ). **

          7. The KEY IDEA must naturally include the rule or principle
          used in solving. The explanation must clearly show what the
          rule says and how it changes the solution process.
          Do not separate it into a special section. Blend it into the teaching.

          --------------------------------------------------

          QUALITY CHECK (MANDATORY):
          - Minimum length: 4-5 full sentences.
          - The explanation must be reusable for any similar problem.
          - If the explanation sounds suitable for a strong student, rewrite it to be simpler.



      </key_idea>

      <question_cognitive_indirectness_rule>
              All questions must be grade-appropriate in mathematical level,
              but the required relationship must NOT be directly visible or immediately usable.

              The student should NOT be able to answer by applying one property immediately after reading the question.

              Instead, the question must require the student to FIRST interpret the diagram
              and identify hidden or intermediate relationships before using the target concept.

              This means:

              • The required angles should not be labelled in an obvious pair.
              • The needed relationship should be embedded among other angles.
              • An intermediate angle or relation must be recognized before solving.
              • The question must require interpretation BEFORE calculation.

              Direct question patterns that are NOT allowed:
              ❌ “Find x if these two angles form a linear pair”
              ❌ “Name the vertically opposite angles”
              ❌ “If l || m find angle ABC”
              ❌ Any question where the used property is explicitly stated or visually isolated.

              Allowed question style:
              ✔ Student must determine WHICH angles are related first.
              ✔ Student must locate the correct relationship from multiple possibilities.
              ✔ Student must derive an intermediate angle before the final step.
              ✔ The diagram contains extra information not immediately useful.

              The mathematics must remain Grade level,
              but the path to the concept must require recognition, interpretation, and selection.
              If a student can identify the required property within 5 seconds of reading the question,
              the question is too direct and must be redesigned.
      </question_cognitive_indirectness_rule>

            
      <question_enhancement_idea>

        Use textbook-style geometric structure as inspiration (clarity, multiple relations, meaningful layout), but DO NOT copy any figure. Reconstruct a new configuration that shows layered relationships (intersections, parallels, transversals, angle links) rather than a single simple shape.
        Each diagram must support reasoning across multiple connected elements, and every question must depend on these structural relationships — not just direct measurement or one-step observation.
        Analyse the exercise of each topic so that you can make better questions. Better figures, common figures are not required try to make outside the box figures which is realastic

      </question_enhancement_idea>
      <DOK_level_explanation>
            COGNITIVE DEPTH & OLYMPIAD REASONING MODE (MANDATORY)

            All questions must be grade-appropriate in content,
            but non-direct and structure-based in reasoning.

            The required concept must NOT be immediately usable.
            Students must interpret the situation, identify relationships,
            and use intermediate reasoning before reaching the answer.

            --------------------------------
            DOK STRUCTURAL DEFINITIONS
            --------------------------------

            DOK 1 — Recognition
            • Identify, label, classify, or read directly.
            • No calculation.
            • No inference chain.

            DOK 2 — Sequential Application
            • Solve using TWO or more connected steps.
            • Must require an intermediate result.
            • Must combine different pieces of information.

            DOK 3 — Constraint-Based Reasoning
            • A condition or claim must be evaluated.
            • Student must analyse relationships across the whole structure.
            • Answer must be justified by consistency, necessity, or elimination.
            • Requires interpretation before solving.

            --------------------------------
            OLYMPIAD STRUCTURE RULES
            --------------------------------

            • The solution path must not be obvious.
            • Multiple elements must interact (not a single relation).
            • Some information should be indirect or distracting.
            • The answer must be forced by constraints, not direct substitution.
            • At least one intermediate inference must be necessary.

            --------------------------------
            DIRECTNESS CHECK (MANDATORY)
            --------------------------------

            If the required method is obvious immediately,
            or a single direct step gives the answer,
            the question must be redesigned.

                  
            - whatever you are thinking to make question make it one lvel up so that it will be in proper dok level

      </DOK_level_explanation>

      <scenario_design>
        Generate a real-life mathematics word problem.

        HARD SCENARIO RULES:
        - Use ONE clear, continuous scenario only.
        - The situation must naturally require the mathematical method being tested.
        - Do NOT introduce a second, unrelated idea or purpose.
        - The question must feel like something a real person would actually do.

        REALISM RULES:
        - Use quantities that are believable in real life.
        - Avoid exaggerated or impractical counts unless clearly justified.
        - Prefer situations where exact counting or equal grouping is realistic and meaningful.

        FLOW & PURPOSE RULES:
        - The story should clearly explain WHY the calculation is needed.
        - If the question has subparts, each subpart must directly follow from the same situation.
        - Do NOT test abstract method knowledge unless the scenario logically demands it.

        SCENARIO VARIETY RULES:
        - Do NOT repeat similar scenarios across questions (e.g., farmer/gardener/planting).
        - Rotate contexts meaningfully (shopping, packing, classroom, transport, sports, etc.).
        - Changing only object names is NOT considered variety.

        QUESTION QUALITY CHECK (MANDATORY):
        - Read the problem as a story: it must sound natural when read aloud.
        - The real-life context should help understanding, not just decorate the math.
        - If the scenario feels forced or artificial, rewrite it.
      ##IMPORTANT FOR SCENARIO BASED QUESTIONS :
        When creating scenario-based questions:

      - Do NOT start from the concept or question and then invent a story.
      - FIRST choose a real-life situation, object, or practice that naturally exists
        (e.g., sundials, clocks, abacuses, inscriptions, calendars, measuring tools).
      - The mathematical or scientific concept must arise naturally from this situation.
      - The question should feel like a natural curiosity or problem caused by the scenario.
      - If the scenario is removed and the question still makes sense, the scenario is artificial → reject it.
      - Do NOT use generic characters, professions, or filler stories.
      - Prefer real artifacts, processes, or observations over human narratives.

      Bad example (artificial scenario – do NOT do this):

      "Emily is a museum curator learning about number systems. She writes the following
      statements about the Hindu–Arabic system. Which statements are true?
      I. The expanded place value representation of the number 8045 is (8 × 10³) + (4 × 10¹) + (5 × 1)."

      Why this is bad:
      - The scenario is added after the question is formed.
      - The character and setting have no effect on the reasoning.
      - Removing the story does not change the question.
      - The scenario does not force the concept to appear.
      - There is no proper flow between the scenario and the question

      Use this example as a rejection reference for artificial scenarios.


      Validation check:
      "Did the real-life situation force this question to exist?"
      If not, rewrite or remove the scenario.
      ## CORE RULES OF MULTI-PART QUESTIONS
        - This is NOT a Case Study.
        - There is NO detailed scenario paragraph.
        - A **short 1–2 line direct context** is allowed (see Context Rule), but NO storytelling.
        - **IMPORTANT**: The context must be completely free of "classroom" or "learning" framing (e.g., no "students learning", "teacher asking").
        - Each sub-part must directly test mathematical computation, reasoning, or application.
        - The question must NOT require outside information; everything must be solvable using the given prompt and diagram.
        - Every question must follow the specific sub-part configuration provided for it in the TOPICS section, with all sub-parts from the same subtopic.
        - **Final Answer Rule**: The expected answer for each sub-part must be a **single word, phrase, or number**. Do NOT use full sentences for the final answer (eg:  dont use definition of a theorem or a formula).
        - Each subtopic must produce one complete question.
        - Its an NCERT syllabus based question and solution.
        - Should not include equations from physics or chemistry( like force, work etc), everything should be mathematical

      </scenario_design>
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <taxonomy>
        **Taxonomy Lock Rule**
        - For every question type, the user will explicitly specify:
          - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
          - DOK level
          - Marks
        - You MUST use **only the taxonomy provided for that question type**.
        - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
        - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.

        
      </taxonomy>

      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.

        1. Do not introduce any terminology, unit, operation, theorem, transformation, or representation that is not present in the textbook/PDF.
        2. If the textbook uses specific representations (e.g., turns instead of degrees for rotational symmetry), you must use the same representation consistently.
        3. If the textbook omits a representation or concept (e.g., order of rotational symmetry, angle measures, orientation mapping, matrices, coordinate geometry), do not introduce it.
        4. Do not upgrade the abstraction level (e.g., do not convert fractions of turns into degrees or other advanced forms).unless in textbook its there 
        5. Do not use any problem-solving technique, domain language, or reasoning step that students at this grade have not been taught based on the textbook/PDF.
        6. During validation, flag and repair any violation of these rules automatically without altering the structural format of the question type.
        7. Textbook/PDF takes priority over general NCERT content. Only use NCERT-level knowledge if it naturally aligns and does not introduce new constructs.
        8. If a representation or construct is missing in the textbook/PDF, treat it as prohibited.

        Enforcement:
        - These rules apply to the question, solution, distractor analysis, and key idea.
        - Any violation must be corrected before final output.
        - Even when content is limited to a single topic, you MUST generate variety through:
            • different numerical setups
            • different problem contexts
            • different reasoning approaches
            • different applications of the same concept
        - Questions should test mathematical understanding, not reading comprehension of textbook material.
        - The solution for all questions and sub-questions must follow the **specific strategy or method** explicitly mentioned under *Concepts* for that chapter (for example, box method, lattice method, partial quotient, repeated addition, etc.).  
        - If the chapter introduces or emphasizes a particular technique (e.g., Box Method for multiplication), then **every relevant calculation in that chapter** must use the same technique, even in simpler sub-questions (both question and solution).  
        - The solution must be grade level appropriate.
        - This ensures consistency with what the student is currently being taught at that grade level.  
        - Only if no specific method is mentioned in the concepts should the general grade-appropriate method be used.
        - **Do not** use or refer to physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - All sub-questions must be completely based on the scenario only(Dont give question outside the scenario), not on outside knowledge or assumptions. 
          Eg : 
            “In the scenario and the diagram, the value **0.1 cm** is never mentioned.
            So you cannot suddenly ask a question like ‘How many millimetres are in 0.1 cm?’ when that number does not appear anywhere in the given information.”

      </what_not_to_do>
      
    </requirements>
    <output_format>
      Return a valid JSON object:
      {
        "questions": [
          {
            "question_id": "Q1 (matching input)",
            "scenario_text": "The narrative story (no numbers).",
            "diagram_description": "Description of the visual setup with values.",
            "questions_list": [
              "Sub-question 1",
              "Sub-question 2..."
            ],
            "solution": "Solution for all sub-questions",
            "key_idea": "Key idea for all sub-questions"
          },
          ...
        ]
      }
    </output_format>
  </writer_generation>


descriptive_math_core: |
  <math_core_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <chapter>{{Chapter}}</chapter>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
      The user needs the following specific questions designed:
      {{Question_Specific_Requirements}}
    </design_requirements>
    
    <task>  
        You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

        STRICT RULES:  
        - Do NOT write a story.  
        - Do NOT write a scenario.  
        - Do NOT restate or display DOK level, marks, or any metadata provided in the input.  
        - ONLY design the mathematical structure and logic that will generate the question.  
        - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

        For EACH question listed in <design_requirements>, define:

        1. **Abstract Math Structure**  
          - The underlying mathematical framework (e.g., Right Triangle, Linear Pair, Quadratic Curve, etc.)  
          - Must be deep enough to support the required reasoning complexity.

        2. **Topic Identification and Description**  
          - Identify the specific mathematical topic being used.  
          - Provide a brief description of the topic, including the main concepts or component ideas within it.

        3. **Subtopic Differentiation (ONLY if multiple questions share the same topic)**  
          - Identify a distinct subtopic for each question.  
          - Subtopics must be unique across questions.  
          - Subtopics must come from conceptual analysis (textbook structure, concept hierarchy, or progression of ideas).

    </task>

    <requirements>

    1. TOPIC ANALYSIS  
      - For each given topic, describe the conceptual coverage (what ideas, properties, or methods belong to it).  
      - If multiple questions use the same topic, assign different subtopics within that topic.

    2. STRUCTURAL COMPLEXITY  
      - The math structure must be sufficiently rich to support the required reasoning level.  
      - The structure must naturally produce the intended mathematical task.

    3. ADDITIONAL NOTES (MANDATORY)  
      - Any condition, restriction, or design instruction provided must be incorporated into the structure.

    4. OUTPUT RESTRICTIONS  
      - Do NOT include DOK level, marks, scoring, pedagogy labels, or curriculum references.  
      - Only output structural mathematical design.

    </requirements>
    
    <requirements>
      - For each question you will be given Topics. From that topic you need to find give the descripation of the topic with the help of the pdf/ new concept (what all subtopics are there)
      1. COMPLEXITY: The math structure must be deep enough to support the requested questions and DOK.
    </requirements>
    
    <output_format>
      Return a valid JSON object:
      {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name and its description",
            ...
          },
          ...// next object(question) with same structure
        ]
      }
    </output_format>
  </math_core_generation>

descriptive_writer: |
  <writer_generation>
    <context>
       <grade>{{Grade}}</grade>
       <requirements>{{Question_Requirements}}</requirements>
       <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    <math_blueprint>
       {{MATH_CORE_DATA}}
    </math_blueprint>
    <task>
       You are a teacher preparing Assertion–Reason–type higher-order questions for Mathematics for Final exams. The questions as well as the solution should be of higher quality.
       Follow all the rules and structure precisely.
    </task>

    <requirements>

      <descriptive_structure>
        1. QUESTION METADATA (Display above the question)
          - Topic Used: exact topic name
          - Descriptive Type: one of the following
              • Descriptive (Number Based)
              • Descriptive (Image Based)
              • Descriptive (Real World Word Questions)
              • Descriptive (Real World Image-Based Word Questions)
          - Marks: total marks
          - DOK Level: specified level
          - Taxonomy: exact taxonomy provided

        2. QUESTION
          - One single, cohesive descriptive problem
          - No sub-questions (no a, b, c parts)
          - Must produce exactly one final answer
          - Must strictly use only the assigned topic
          - Must match the required descriptive type
          - Must be fully self-contained
          - Must use grade-appropriate language
          - If real-world based → realistic and continuous scenario
          - No classroom or academic settings
          - All required numerical data must be clearly provided


        3. DIAGRAM PROMPT (If applicable)
          - Description of the diagram to be drawn
          - Written as a continuous narrative (not bullet points)
          - Exam-ready visual representation
          - Includes necessary labels, units, and measurable values
          - Must directly represent the scenario or mathematical setup
          - If not required → write: "No diagram"

        4. STEP-BY-STEP SOLUTION (With mark allocation)

          Each step must include:
          - Step number
          - Step description/title
          - Marks assigned to that step
          - Detailed reasoning and calculation

          Rules:
          - Marks must be distributed across steps
          - Step marks must sum to total marks
          - Allowed mark increments: 0.5 / 1 / 1.5 / 2 / etc.
          - Show full working and explanation
          - Use grade-appropriate method
          - Follow the method specified in concepts (if provided)

        5. FINAL ANSWER
          - Concise result only
          - No full sentences
          - If numerical → exactly one answer
          - If descriptive → multiple equivalent forms allowed

        6. KEY IDEA (Teaching explanation for weak learners)

          Must include:
          - Simple explanation of the type of problem
          - Core idea explained from zero background
          - Why the idea works (simple logic)
          - General step-by-step solving method
          - Common student mistakes
          - Tips to avoid mistakes

          Rules:
          - Very simple language
          - No numbers, symbols, variables, or equations from the question
          - Must be reusable for similar problems
          - Minimum 4–5 sentences
          - Must naturally explain the rule or principle used

        ---


      </descriptive_structure>

      <descriptive_types>
          1. Descriptive (Number Based)
            Description:
              A descriptive question requiring a written mathematical explanation or step-by-step reasoning using only numbers, symbolic patterns, or abstract conditions.
              There is no image and no real-world narrative. The student must justify or compute in detail.
            Examples:
              Consider the given sequence 2, 4, 8, 16, ....
              What is the sum of the first six terms in this sequence?
              (Show steps to arrive at the solution)

              Observe the pattern of dots arranged symmetrically in layers in the given grid.
              How many dots are there in the fourth arrangement?
              Since the arrangement forms a perfect square, what number squared equals this total?

              A triangle is to be formed using three sticks. Two of these sticks measure 18 cm and 15 cm in length, respectively.
              What are the maximum and minimum possible values for the perimeter of the triangle, considering only whole number lengths for the third stick?

          2. Descriptive (Image Based)
            Description:
              A descriptive question where the main mathematical information is provided visually through an image, diagram, or geometric construct.
              There is no real-world narrative. The student interprets the image and explains results, patterns, or relationships.
            Example (with Diagram Prompt):
              Diagram Prompt:
              Show a sequence of regular polygons increasing in number of sides (triangle, square, pentagon, hexagon, etc.) arranged in order.
              Question:
              Observe the sequence of regular polygons in the image.
              Explain the pattern in how the number of sides increases.
              Determine the number of sides of the next polygon in the sequence and name it.

            Example (with Diagram Prompt):
              Diagram Prompt:
              Draw a rectangle with a diagonal labelled such that triangle A and triangle B are visible on the two halves.
              Question:
              Using the property "A diagonal of a rectangle divides a rectangle into two equal triangles,"
              Determine the following:
              What is the area of triangle A?
              What is the area of triangle B using the same property?
              How does the area of triangle A compare to the area of triangle B?

          3. Descriptive (Real World Word Questions)
            Description:
              A descriptive question framed using real-life scenarios described entirely in words.
              No images are used. The context provides realistic quantities, costs, or actions, requiring step-by-step explanation and justification.
            Examples:
              Saranya and her 14 friends went to a shop and bought 15 identical chart papers, for their project.
              Each chart paper costs ₹6.
              For each chart paper bought in addition to the first 10, they received a discount of ₹3.
              They decided to split the total cost equally among themselves.
              How much should one pay for the chart paper?
              If Saranya paid ₹10 as her share, how much amount did she pay in extra?

          4. Descriptive (Real World Image-Based Word Questions)
            Description:
              A descriptive question based on a real-world scenario supported by an image.
              Both context and visual information are required to reason or explain mathematically.
            Example (with Diagram Prompt):
              Diagram Prompt:
              Draw a network of 5 computers with lines showing possible direct connections between every pair.
              Question:
              In a network of computers shown in the image, each computer must be connected directly to every other computer to ensure smooth communication.
              How many connections will be made in the network?
              Due to budget constraints, if each computer can only connect to 3 other computers instead of all 4.
              How many connections are left unmade in the network compared to the original plan?

          ## Descriptive Type Selection Rule (CRITICAL)
          - In the TOPICS_SECTION, each question may optionally specify an "Descriptive Type".
          - If "Descriptive Type" is specified, you **MUST STRICTLY** generate a question that fits that specific definition and style.
          - If "Descriptive Type" is "Auto" or NOT specified, you must choose the most appropriate type based on the topic and grade level, ensuring variety across the set.


      </descriptive_types>

      <diagram_rules>
          - Diagram is optional (unless the topic inherently requires visual representation).
          - If included, give a **diagram prompt** (NOT the actual image).
          - If the topic inherently requires visual representation, then the diagram is mandatory.And the questions in the topic should be image based and everything should be related to the image .
          
          Diagram Prompt Guidelines:
          
            **Purpose**: Create exam-ready visual representations that support the question.
            
            **Content Requirements**:
              - It should describe the scene (NOT just "make 2 shapes with these lengths")
              - Must be an image suitable for putting in an exam paper
              - Should contain the scene with marking of values if needed
              - Create a realistic, data-based diagram that directly represents the situation
              - Visually match the setup (e.g., areas, objects, sections, or people mentioned) using relevant numerical values
              - Include only essential measurable details — such as quantities, time, cost, length, or rates — with proper units
              - Keep it simple, consistent, and self-contained
              - The diagram must reflect the same context as the question but present it through clear numbers or labeled visuals
            - Do not copy or reuse any figures or images from the provided PDF or uploaded materials. Do not include actual diagrams. Only generate an original diagram prompt as a text description,
            
            **Format Requirements**:
              - Do NOT give point-by-point descriptions
              - Use continuous narrative that properly defines everything
              - Write as a cohesive description, not a bulleted list
            
            Numerical Placement Rules:
              - **Diagram Prompt**: Introduce actual values, quantities, or relationships
              - **Question**: Use those numbers for reasoning, comparison, and problem-solving
            
            No-Repetition Rule:
              - Details or data mentioned in the context must NOT be repeated in the diagram
              - Details or data in the diagram must NOT be repeated in the sub-questions
              - Each section must serve a distinct purpose:
                  • Short Context = Real-life setup and qualitative description
                  • Diagram = Visual/numerical representation of the setup
                  • Question = Logical and mathematical reasoning based on both

        
      </diagram_rules>
      
      <solution_format>
        - The solution must be detailed and broken down into **steps**.
        - **Each step must clearly show:**
            1. Step number (Step 1, Step 2, Step 3, etc.)
            2. Step title/description
            3. **Marks allocated to that specific step** - shown as (Mark: 1) or (1 Mark)
            4. Detailed explanation and calculation for that step
        
        - **Step-wise Marking Rules:**
            - You MUST assign marks for each individual step
            - Clearly display the mark allocation in each step heading
            - The sum of all step marks must equal the total marks for the question
            - marks should be 0.5/1/1.5/2/3 ... 
        - **Format pattern:**
            **Step 1: [Title/Description of Step] (Mark: 1)**
            [Detailed explanation and calculation]
            
            **Step 2: [Title/Description of Step] (Mark: 1)**
            [Detailed explanation and calculation]
            
            **Step 3: [Title/Description of Step] (Mark: 1)**
            [Detailed explanation and calculation]

        - Backtracking solution in detail: Explanation should be thorough, showing the 'why' and 'how'.

      </solution_format>

      <final_answer>
        
        -If the final answer after the explanation can be written as multiple forms then you need to generate probable answers 
        for the final answer.

        Condition for supporting single and multiple forms :

          - If the question is **numerical or computational**, allow **only one correct answer**.
          - If the question is **descriptive or any non-numerical type**, allow **multiple acceptable answers**.

          **Example 1 - Computational/Closed-ended:**
          
          Question: "Find the value of the 10th term in the arithmetic progression 3, 7, 11, 15..."
          
          Final Answer: **39**
          (Only one correct answer - numerical computation)

          **Example 2 - Proof/Open-ended with descriptive elements:**
          
          Question: "Prove that the sum of any three consecutive odd numbers is always divisible by 3."
          
          Final Answer: **Proved** OR **Hence proved** OR **Therefore, the sum is divisible by 3**
          (Multiple acceptable forms - all convey the same meaning)

          **Example 3 - Mixed (numerical answer with units):**
          
          Question: "A rectangular park has length 50 m and breadth 30 m. Find the area of the park."
          
          Final Answer: **1500 m²** OR **1500 sq m** OR **1500 square metres**
          (Multiple acceptable forms - different representations of the same answer)

        -- In descriptive questions after the exaplantaion of solution the type of final answer should be decided based on the above rule.
        -- **CRITICAL**: The generated "Final Answer" must be concise (number, word, or short phrase). Do NOT write full sentences like "The shape is called a square." -> Write "Square".
      

      </final_answer>

      <key_idea>

        You must write a KEY IDEA meant for a weak or struggling student.

        ASSUME:
        - The student has NEVER seen this topic before.
        - The student does NOT know any technical or mathematical terminology.

        HARD RULES (DO NOT VIOLATE):
        - Do NOT mention any numbers, symbols, variables, equations, diagrams, or values from the question.
        - Do NOT use advanced or textbook-style language.
        - Do NOT write in a single flowing paragraph.
        - Do NOT skip or merge sections.
        - The explanation must work for ANY similar question of this type.

        LANGUAGE RULES:
        - Use very simple, school-level English.
        - Prefer short sentences.
        - If a word sounds technical, explain it immediately or avoid it.
        - Write as if you are teaching a confused student one-on-one.

        --------------------------------------------------

        REQUIRED STRUCTURE (WRITE EXACTLY IN THIS ORDER):

        KEY IDEA

        1. What kind of problems these are  
        Explain in simple words what these questions are generally asking the student to understand or find.

        2. Core idea behind these problems  
        Explain the main idea from the beginning, as if the student has zero background knowledge.

        3. Why this idea works  
        Explain logically why this method makes sense in real understanding, not just as a rule to memorize.

        4. General step-by-step method  
        Write this as clearly numbered steps:
        Step 1:  
        Step 2:  
        Step 3:  
        Step 4:  

        Each step must describe ONE clear action the student should take.

        5. Common mistakes students make  
        Mention at least two common mistakes and explain why students make them.

        6. Tips to avoid these mistakes  
        Give simple, practical tips written directly for a student.
        **- Do NOT explicitly break the explanation into “What kind of problems”, “Core idea”,"Common mistakes students make  " or “Why this works”.
        Do NOT restate or refer to the given question (Why this idea works .. etc ). **

        7. The KEY IDEA must naturally include the rule or principle
        used in solving. The explanation must clearly show what the
        rule says and how it changes the solution process.
        Do not separate it into a special section. Blend it into the teaching.


      </key_idea>

      <question_cognitive_indirectness_rule>
              All questions must be grade-appropriate in mathematical level,
              but the required relationship must NOT be directly visible or immediately usable.

              The student should NOT be able to answer by applying one property immediately after reading the question.

              Instead, the question must require the student to FIRST interpret the diagram
              and identify hidden or intermediate relationships before using the target concept.

              This means:

              • The required angles should not be labelled in an obvious pair.
              • The needed relationship should be embedded among other angles.
              • An intermediate angle or relation must be recognized before solving.
              • The question must require interpretation BEFORE calculation.

              Direct question patterns that are NOT allowed:
              ❌ “Find x if these two angles form a linear pair”
              ❌ “Name the vertically opposite angles”
              ❌ “If l || m find angle ABC”
              ❌ Any question where the used property is explicitly stated or visually isolated.

              Allowed question style:
              ✔ Student must determine WHICH angles are related first.
              ✔ Student must locate the correct relationship from multiple possibilities.
              ✔ Student must derive an intermediate angle before the final step.
              ✔ The diagram contains extra information not immediately useful.

              The mathematics must remain Grade level,
              but the path to the concept must require recognition, interpretation, and selection.
              If a student can identify the required property within 5 seconds of reading the question,
              the question is too direct and must be redesigned.

      </question_cognitive_indirectness_rule>

            
      <question_enhancement_idea>

        Use textbook-style geometric structure as inspiration (clarity, multiple relations, meaningful layout), but DO NOT copy any figure. Reconstruct a new configuration that shows layered relationships (intersections, parallels, transversals, angle links) rather than a single simple shape.
        Each diagram must support reasoning across multiple connected elements, and every question must depend on these structural relationships — not just direct measurement or one-step observation.
        Analyse the exercise of each topic so that you can make better questions. Better figures, common figures are not required try to make outside the box figures which is realastic

      </question_enhancement_idea>
      <DOK_level_explanation>
            COGNITIVE DEPTH & OLYMPIAD REASONING MODE (MANDATORY)

            All questions must be grade-appropriate in content,
            but non-direct and structure-based in reasoning.

            The required concept must NOT be immediately usable.
            Students must interpret the situation, identify relationships,
            and use intermediate reasoning before reaching the answer.

            --------------------------------
            DOK STRUCTURAL DEFINITIONS
            --------------------------------

            DOK 1 — Recognition
            • Identify, label, classify, or read directly.
            • No calculation.
            • No inference chain.

            DOK 2 — Sequential Application
            • Solve using TWO or more connected steps.
            • Must require an intermediate result.
            • Must combine different pieces of information.

            DOK 3 — Constraint-Based Reasoning
            • A condition or claim must be evaluated.
            • Student must analyse relationships across the whole structure.
            • Answer must be justified by consistency, necessity, or elimination.
            • Requires interpretation before solving.

            --------------------------------
            OLYMPIAD STRUCTURE RULES
            --------------------------------

            • The solution path must not be obvious.
            • Multiple elements must interact (not a single relation).
            • Some information should be indirect or distracting.
            • The answer must be forced by constraints, not direct substitution.
            • At least one intermediate inference must be necessary.

            --------------------------------
            DIRECTNESS CHECK (MANDATORY)
            --------------------------------

            If the required method is obvious immediately,
            or a single direct step gives the answer,
            the question must be redesigned.

                  
            - whatever you are thinking to make question make it one lvel up so that it will be in proper dok level

      </DOK_level_explanation>

      
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <taxonomy>
        **Taxonomy Lock Rule**
        - For every question type, the user will explicitly specify:
          - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
          - DOK level
          - Marks
        - You MUST use **only the taxonomy provided for that question type**.
        - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
        - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.

        
      </taxonomy>

      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.

      </what_not_to_do>
      
    </requirements>
     <output_format>
       Return JSON: 
      {
        "questions": [
          {
            "question_id": "Q1",
            "question_text": "...",
            "diagram_prompt": ""
            "final_answer": "correct answer for each blanks [|TEXT n|or |DROP N|]", 
            "solution": "Brief explanation...",
            "key_idea": "Key concept..."
            
          },
          // .. next question in same format
        ]
      }
    </output_format>
  </writer_generation>



descriptive_with_subq_math_core: |
  <math_core_generation>
    <context>
      <grade>{{Grade}}</grade>
      <subject>{{Subject}}</subject>
      <chapter>{{Chapter}}</chapter>
      <topic>{{Topic}}</topic>
      <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    
    <design_requirements>
      The user needs the following specific questions designed:
      {{Question_Specific_Requirements}}
    </design_requirements>
    
    <task>  
      You are the **"Architect"**. Your role is to design the **Math Core** for the requested questions.

      STRICT RULES:  
      - Do NOT write a story.  
      - Do NOT write a scenario.  
      - Do NOT restate or display the Topic name.  
      - Do NOT display DOK level, marks, or any metadata provided in the input.  
      - ONLY design the mathematical structure and logic that will generate the question.  
      - If **Additional Notes** are provided, they are mandatory design constraints and must be applied.

      For EACH question listed in <design_requirements>, define:

      1. **Abstract Math Structure**  
        - The underlying mathematical framework (e.g., Linear Pair, System of Equations, Right Triangle with altitude, etc.)  
        - Must be deep enough to logically support all required sub-questions.

      2. **Sub-question Logic**  
        - Explain how the structure supports multiple sub-questions in a progressive or connected way.  
        - The structure must naturally allow increasing reasoning complexity.

      3. **Sub-question Breakdown**  
        For EACH sub-question provide:
        - **Subtopic (unique — cannot repeat across sub-questions)**  
        - **Brief Description** explaining what mathematical idea or operation is being tested.

    </task>

    <requirements>

      1. SUBTOPIC SELECTION  
        - Identify different subtopics from within the given topic domain.  
        - Each sub-question MUST use a distinct subtopic.  
        - Subtopics must come from concept analysis (textbook, syllabus progression, or logical concept hierarchy).

      2. STRUCTURAL COMPLEXITY  
        - The math structure must be sufficiently rich to support all sub-questions logically.  
        - Sub-questions must emerge naturally from the same structure (not disconnected tasks).

      3. ADDITIONAL NOTES (MANDATORY)  
        - If any constraint, condition, value restriction, or design instruction appears in Additional Notes, it MUST be incorporated into the structure and sub-question logic.

      4. OUTPUT RESTRICTIONS  
        - Do NOT include:DOK level, marks, scoring, pedagogy labels,explanation of curriculum alignment, or **how to make questions**.  
        - Only output structural mathematical design.

    </requirements>
    
    <output_format>
      Return a valid JSON object:
      {
        "math_cores": [
          {
            "id": "Q1",
            "Topic": "topic name",
            "subquestion_1": "subtopic and its description",
            "subquestion_2": "subtopic and its description",
            ...
          },
          ...// next object with same structure
        ]
      }
    </output_format>
  </math_core_generation>

descriptive_with_subq_writer: |
  <writer_generation>
    <context>
       <grade>{{Grade}}</grade>
       <requirements>{{Question_Requirements}}</requirements>
       <additional_notes>{{Additional_Notes}}</additional_notes>
    </context>
    <math_blueprint>
       {{MATH_CORE_DATA}}
    </math_blueprint>
    <task>
       You are a teacher preparing Assertion–Reason–type higher-order questions for Mathematics for Final exams. The questions as well as the solution should be of higher quality.
       Follow all the rules and structure precisely.
    </task>

    <requirements>

      <descriptive_structure>
        1. QUESTION METADATA (Display above the question)
          - Topic Used: exact topic name
          - Descriptive Type: one of the following
              • Descriptive (Number Based)
              • Descriptive (Image Based)
              • Descriptive (Real World Word Questions)
              • Descriptive (Real World Image-Based Word Questions)
          - Marks: total marks
          - DOK Level: specified level
          - Taxonomy: exact taxonomy provided

        2. QUESTION
          - One cohesive descriptive problem built within a single continuous scenario
          - The total marks for the question will be specified
          - You MUST divide the question into meaningful sub-parts within the same scenario
          - You MUST split the total marks intelligently across these sub-parts
          - Each sub-part must assess a logical step in solving the overall problem
          - Each sub-part must carry meaningful marks (minimum 0.5, use increments of 0.5 only)
          - The sum of all sub-part marks MUST exactly equal the total marks of the question

          Example mark distributions:
              • 3 marks total → (a) 1 mark, (b) 1 mark, (c) 1 mark
              • 4 marks total → (a) 1.5 marks, (b) 1.5 marks, (c) 1 mark
              • 5 marks total → (a) 1.5 marks, (b) 2 marks, (c) 1.5 marks
              • 6 marks total → (a) 2 marks, (b) 2 marks, (c) 2 marks

          - Must strictly use only the assigned topic
          - Must match the required descriptive type
          - Must be fully self-contained
          - Must use grade-appropriate language
          - If real-world based → realistic and continuous scenario
          - No classroom or academic settings
          - All required numerical data must be clearly provided



        3. DIAGRAM PROMPT (If applicable)
          - Description of the diagram to be drawn
          - Written as a continuous narrative (not bullet points)
          - Exam-ready visual representation
          - Includes necessary labels, units, and measurable values
          - Must directly represent the scenario or mathematical setup
          - If not required → write: "No diagram"

        
    - **Single Solution with Distributed Steps**:
        - Create ONE cohesive solution that flows naturally
        - The question has a single mathematical context/problem
        - Steps are logically distributed between sub-parts
        - Sub-part (a) can have multiple steps
        - Sub-part (b) can have multiple steps (building on (a))
        - Sub-part (c) can have multiple steps (building on (a) and (b) if exists)
        - Each step within a sub-part shows its allocated marks
        - Sum of all step marks in a sub-part must equal the sub-part's total marks
    
    - **Progressive Difficulty**:
        - Sub-parts should build on each other naturally
        - Part (a): Foundation/basic step (typically easier)
        - Part (b): Intermediate/application step  
        - Part (c): Advanced/conclusion step (if exists)
    
    - **Question Structure**:
        - Single main context/scenario (1-2 lines maximum)
        - Sub-questions labeled (a), (b), (c) as needed
        - Each sub-part asks something specific related to the core problem
        - All sub-parts relate to the same core concept/scenario
        - No storytelling or lengthy scenarios

    - **Question Types**: Generate a mix of both:
        - **Closed-ended/Computational**: "Find...", "Calculate...", "Determine...", "Compute..." (questions with specific numerical or definite answers)
        - **Open-ended/Proof-based**: "Prove that...", "Show that...", "Justify that...", "Demonstrate..." (can be used in appropriate sub-parts)
    

     **. KEY IDEA (Teaching explanation for weak learners)

          Must include:
          - Simple explanation of the type of problem
          - Core idea explained from zero background
          - Why the idea works (simple logic)
          - General step-by-step solving method
          - Common student mistakes
          - Tips to avoid mistakes

          Rules:
          - Very simple language
          - No numbers, symbols, variables, or equations from the question
          - Must be reusable for similar problems
          - Minimum 4–5 sentences
          - Must naturally explain the rule or principle used

        ---


      </descriptive_structure>

      <descriptive_types>
        1. Descriptive (Number Based)
          Description:
            A descriptive question requiring a written mathematical explanation or step-by-step reasoning using only numbers, symbolic patterns, or abstract conditions.
            There is no image and no real-world narrative. The student must justify or compute in detail.
          Examples:
            Consider the given sequence 2, 4, 8, 16, ....
            What is the sum of the first six terms in this sequence?
            (Show steps to arrive at the solution)

            Observe the pattern of dots arranged symmetrically in layers in the given grid.
            How many dots are there in the fourth arrangement?
            Since the arrangement forms a perfect square, what number squared equals this total?

            A triangle is to be formed using three sticks. Two of these sticks measure 18 cm and 15 cm in length, respectively.
            What are the maximum and minimum possible values for the perimeter of the triangle, considering only whole number lengths for the third stick?

        2. Descriptive (Image Based)
          Description:
            A descriptive question where the main mathematical information is provided visually through an image, diagram, or geometric construct.
            There is no real-world narrative. The student interprets the image and explains results, patterns, or relationships.
          Example (with Diagram Prompt):
            Diagram Prompt:
            Show a sequence of regular polygons increasing in number of sides (triangle, square, pentagon, hexagon, etc.) arranged in order.
            Question:
            Observe the sequence of regular polygons in the image.
            Explain the pattern in how the number of sides increases.
            Determine the number of sides of the next polygon in the sequence and name it.

          Example (with Diagram Prompt):
            Diagram Prompt:
            Draw a rectangle with a diagonal labelled such that triangle A and triangle B are visible on the two halves.
            Question:
            Using the property "A diagonal of a rectangle divides a rectangle into two equal triangles,"
            Determine the following:
            What is the area of triangle A?
            What is the area of triangle B using the same property?
            How does the area of triangle A compare to the area of triangle B?

        3. Descriptive (Real World Word Questions)
          Description:
            A descriptive question framed using real-life scenarios described entirely in words.
            No images are used. The context provides realistic quantities, costs, or actions, requiring step-by-step explanation and justification.
          Examples:
            Saranya and her 14 friends went to a shop and bought 15 identical chart papers, for their project.
            Each chart paper costs ₹6.
            For each chart paper bought in addition to the first 10, they received a discount of ₹3.
            They decided to split the total cost equally among themselves.
            How much should one pay for the chart paper?
            If Saranya paid ₹10 as her share, how much amount did she pay in extra?

        4. Descriptive (Real World Image-Based Word Questions)
          Description:
            A descriptive question based on a real-world scenario supported by an image.
            Both context and visual information are required to reason or explain mathematically.
          Example (with Diagram Prompt):
            Diagram Prompt:
            Draw a network of 5 computers with lines showing possible direct connections between every pair.
            Question:
            In a network of computers shown in the image, each computer must be connected directly to every other computer to ensure smooth communication.
            How many connections will be made in the network?
            Due to budget constraints, if each computer can only connect to 3 other computers instead of all 4.
            How many connections are left unmade in the network compared to the original plan?

          ## Descriptive Type Selection Rule (CRITICAL)
          - In the TOPICS_SECTION, each question may optionally specify an "Descriptive Type".
          - If "Descriptive Type" is specified, you **MUST STRICTLY** generate a question that fits that specific definition and style.
          - If "Descriptive Type" is "Auto" or NOT specified, you must choose the most appropriate type based on the topic and grade level, ensuring variety across the set.


      </descriptive_types>

      <diagram_rules>
          - Diagram is optional (unless the topic inherently requires visual representation).
          - If included, give a **diagram prompt** (NOT the actual image).
          - If the topic inherently requires visual representation, then the diagram is mandatory.And the questions in the topic should be image based and everything should be related to the image .
          
          Diagram Prompt Guidelines:
          
            **Purpose**: Create exam-ready visual representations that support the question.
            
            **Content Requirements**:
              - It should describe the scene (NOT just "make 2 shapes with these lengths")
              - Must be an image suitable for putting in an exam paper
              - Should contain the scene with marking of values if needed
              - Create a realistic, data-based diagram that directly represents the situation
              - Visually match the setup (e.g., areas, objects, sections, or people mentioned) using relevant numerical values
              - Include only essential measurable details — such as quantities, time, cost, length, or rates — with proper units
              - Keep it simple, consistent, and self-contained
              - The diagram must reflect the same context as the question but present it through clear numbers or labeled visuals
            - Do not copy or reuse any figures or images from the provided PDF or uploaded materials. Do not include actual diagrams. Only generate an original diagram prompt as a text description,
            
            **Format Requirements**:
              - Do NOT give point-by-point descriptions
              - Use continuous narrative that properly defines everything
              - Write as a cohesive description, not a bulleted list
            
            Numerical Placement Rules:
              - **Diagram Prompt**: Introduce actual values, quantities, or relationships
              - **Question**: Use those numbers for reasoning, comparison, and problem-solving
            
            No-Repetition Rule:
              - Details or data mentioned in the context must NOT be repeated in the diagram
              - Details or data in the diagram must NOT be repeated in the sub-questions
              - Each section must serve a distinct purpose:
                  • Short Context = Real-life setup and qualitative description
                  • Diagram = Visual/numerical representation of the setup
                  • Question = Logical and mathematical reasoning based on both

        
      </diagram_rules>
      
      <solution_format>
        - The solution must be detailed and broken down into **steps** within each sub-part.
      - **Each step must clearly show:**
          1. Step number (Step 1, Step 2, Step 3, etc.)
          2. Step title/description
          3. **Marks allocated to that specific step** - shown as (Mark: 0.5) or (Mark: 1) or (Mark: 1.5)
          4. Detailed explanation and calculation for that step
      
      - **Step-wise Marking Rules:**
          - You MUST assign marks for each individual step
          - Clearly display the mark allocation in each step heading
          - The sum of all step marks within a sub-part must equal the sub-part's total marks
          - marks should be 0.5/1/1.5/2/3 ... 
      
      - **Sub-part Structure:**
          Each sub-part should show:
          - Sub-part label with total marks: **(a) [Description] (Marks: X)**
          - Then the steps for that sub-part with individual step marks
      
      - **Format pattern:**
          **(a) [Sub-part description] (Marks: 2)**
          **Step 1: [Title/Description of Step] (Mark: 1)**
          [Detailed explanation and calculation]
          
          **Step 2: [Title/Description of Step] (Mark: 1)**
          [Detailed explanation and calculation]
          
          **(b) [Sub-part description] (Marks: 1.5)**
          **Step 1: [Title/Description of Step] (Mark: 1.5)**
          [Detailed explanation and calculation]
          
          **(c) [Sub-part description] (Marks: 1.5)**
          **Step 1: [Title/Description of Step] (Mark: 0.5)**
          [Detailed explanation and calculation]
          
          **Step 2: [Title/Description of Step] (Mark: 1)**
          [Detailed explanation and calculation]

      </solution_format>

      <final_answer>
            
        -If the final answer after the explanation can be written as multiple forms then you need to generate probable answers.
        
        Condition for supporting single and multiple forms:
        
          - If the question/sub-part is **numerical or computational**, allow **only one correct answer**.
          - If the question/sub-part is **descriptive or any non-numerical type**, allow **multiple acceptable answers**.
        
          **Example - Computational:**
          Question: "Find the value of x"
          Final Answer: **x = 5**
          
          **Example - With units:**
          Final Answer: **1500 m²** OR **1500 sq m** OR **1500 square metres**
          
          **Example - Proof-based:**
          Final Answer: **Proved** OR **Hence proved** OR **Therefore, the statement is true**

        - **CRITICAL**: The generated "Final Answer" must be concise (number, word, or short phrase). Do NOT write full sentences.
        - Provide final answer for EACH sub-part separately.
      </final_answer>

      <key_idea>

        You must write a KEY IDEA meant for a weak or struggling student.

        ASSUME:
        - The student has NEVER seen this topic before.
        - The student does NOT know any technical or mathematical terminology.

        HARD RULES (DO NOT VIOLATE):
        - Do NOT mention any numbers, symbols, variables, equations, diagrams, or values from the question.
        - Do NOT use advanced or textbook-style language.
        - Do NOT write in a single flowing paragraph.
        - Do NOT skip or merge sections.
        - The explanation must work for ANY similar question of this type.

        LANGUAGE RULES:
        - Use very simple, school-level English.
        - Prefer short sentences.
        - If a word sounds technical, explain it immediately or avoid it.
        - Write as if you are teaching a confused student one-on-one.

        --------------------------------------------------

        REQUIRED STRUCTURE (WRITE EXACTLY IN THIS ORDER):

        KEY IDEA

        1. What kind of problems these are  
        Explain in simple words what these questions are generally asking the student to understand or find.

        2. Core idea behind these problems  
        Explain the main idea from the beginning, as if the student has zero background knowledge.

        3. Why this idea works  
        Explain logically why this method makes sense in real understanding, not just as a rule to memorize.

        4. General step-by-step method  
        Write this as clearly numbered steps:
        Step 1:  
        Step 2:  
        Step 3:  
        Step 4:  

        Each step must describe ONE clear action the student should take.

        5. Common mistakes students make  
        Mention at least two common mistakes and explain why students make them.

        6. Tips to avoid these mistakes  
        Give simple, practical tips written directly for a student.
        **- Do NOT explicitly break the explanation into “What kind of problems”, “Core idea”,"Common mistakes students make  " or “Why this works”.
        Do NOT restate or refer to the given question (Why this idea works .. etc ). **

        7. The KEY IDEA must naturally include the rule or principle
        used in solving. The explanation must clearly show what the
        rule says and how it changes the solution process.
        Do not separate it into a special section. Blend it into the teaching.


      </key_idea>
      <question_cognitive_indirectness_rule>
            All questions must be grade-appropriate in mathematical level,
            but the required relationship must NOT be directly visible or immediately usable.

            The student should NOT be able to answer by applying one property immediately after reading the question.

            Instead, the question must require the student to FIRST interpret the diagram
            and identify hidden or intermediate relationships before using the target concept.

            This means:

            • The required angles should not be labelled in an obvious pair.
            • The needed relationship should be embedded among other angles.
            • An intermediate angle or relation must be recognized before solving.
            • The question must require interpretation BEFORE calculation.

            Direct question patterns that are NOT allowed:
            ❌ “Find x if these two angles form a linear pair”
            ❌ “Name the vertically opposite angles”
            ❌ “If l || m find angle ABC”
            ❌ Any question where the used property is explicitly stated or visually isolated.

            Allowed question style:
            ✔ Student must determine WHICH angles are related first.
            ✔ Student must locate the correct relationship from multiple possibilities.
            ✔ Student must derive an intermediate angle before the final step.
            ✔ The diagram contains extra information not immediately useful.

            The mathematics must remain Grade level,
            but the path to the concept must require recognition, interpretation, and selection.
            If a student can identify the required property within 5 seconds of reading the question,
            the question is too direct and must be redesigned.

      </question_cognitive_indirectness_rule>

            
      <question_enhancement_idea>

        Use textbook-style geometric structure as inspiration (clarity, multiple relations, meaningful layout), but DO NOT copy any figure. Reconstruct a new configuration that shows layered relationships (intersections, parallels, transversals, angle links) rather than a single simple shape.
        Each diagram must support reasoning across multiple connected elements, and every question must depend on these structural relationships — not just direct measurement or one-step observation.
        Analyse the exercise of each topic so that you can make better questions. Better figures, common figures are not required try to make outside the box figures which is realastic

      </question_enhancement_idea>
      <DOK_level_explanation>
            COGNITIVE DEPTH & OLYMPIAD REASONING MODE (MANDATORY)

            All questions must be grade-appropriate in content,
            but non-direct and structure-based in reasoning.

            The required concept must NOT be immediately usable.
            Students must interpret the situation, identify relationships,
            and use intermediate reasoning before reaching the answer.

            --------------------------------
            DOK STRUCTURAL DEFINITIONS
            --------------------------------

            DOK 1 — Recognition
            • Identify, label, classify, or read directly.
            • No calculation.
            • No inference chain.

            DOK 2 — Sequential Application
            • Solve using TWO or more connected steps.
            • Must require an intermediate result.
            • Must combine different pieces of information.

            DOK 3 — Constraint-Based Reasoning
            • A condition or claim must be evaluated.
            • Student must analyse relationships across the whole structure.
            • Answer must be justified by consistency, necessity, or elimination.
            • Requires interpretation before solving.

            --------------------------------
            OLYMPIAD STRUCTURE RULES
            --------------------------------

            • The solution path must not be obvious.
            • Multiple elements must interact (not a single relation).
            • Some information should be indirect or distracting.
            • The answer must be forced by constraints, not direct substitution.
            • At least one intermediate inference must be necessary.

            --------------------------------
            DIRECTNESS CHECK (MANDATORY)
            --------------------------------

            If the required method is obvious immediately,
            or a single direct step gives the answer,
            the question must be redesigned.

                  
            - whatever you are thinking to make question make it one lvel up so that it will be in proper dok level

      </DOK_level_explanation>


      
      <knowledge_boundary>
          Treat the uploaded PDFs/images as the only source of knowledge. Do not use any outside syllabus, curriculum, or textbook knowledge. Do not introduce concepts, terminology, skills, or grade-level content that is not explicitly shown in the uploaded material(for question, solution, key-idea for everything. You cant assume if lhs = rhs is not mentioned in the uploaded material but its proving left side = right side, you cant mention lhs = rhs in any part of the generated material). If the material shows addition, subtraction, even/odd numbers, halving, or true/false reasoning, generate new items only using those same concepts. Do not name properties, laws, or theories unless they are explicitly printed in the PDF/image.
          Generate new/duplicate questions that match the original item structure, same difficulty level, and same style. Do not increase the grade level or add any new concepts. Do not assume hidden mathematical knowledge. Do not infer properties (example: do not mention commutativity unless the PDF/image names it). Do not introduce higher grade concepts.
          The uploaded content defines a closed knowledge boundary. If a concept, method, property, term, or instruction is not present in the PDF/image, do not include it in the generated items. Stay fully faithful to the language, style, tasks, operations, and reasoning patterns present in the PDF/image.
      </knowledge_boundary>
      <taxonomy>
        **Taxonomy Lock Rule**
        - For every question type, the user will explicitly specify:
          - Taxonomy (e.g., Remembering, Understanding, Applying, Analyzing, etc.)
          - DOK level
          - Marks
        - You MUST use **only the taxonomy provided for that question type**.
        - Do NOT substitute, infer, upgrade, downgrade, or mix taxonomies.
        - If a question cannot be generated under the given taxonomy, you must still stay within it and simplify the question accordingly.

        
      </taxonomy>

      <what_not_to_do>
        - Do not use any physics, chemistry, biology, or other science formulas (e.g., density, force, pressure, velocity).
        - Do not use any real-world scenarios that are not related to the topic.
        - **Do NOT treat the textbook/concept excerpts as reading passages in questions**
        - **Do NOT reference the textbook/concept material as a passage**
        - Questions must be self-contained and NEVER reference the source material directly
        All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited.

        **FORBIDDEN question/Answer patterns:**
        - ❌ "According to the textbook..."
        - ❌ "According to the definition provided in the chapter..."
        - ❌ "The story on page 13 mentions..."
        - ❌ "The definition on page X specifically states..."
        - ❌ "Based on the passage/story/definition provided..."
        - ❌ "As described in the concept/chapter..."
        - ❌ " identify the relationship between Row 2 and Row 3 based on Theorem 6.6."
        - Questions must be self-contained and NEVER reference the source material directly
        - All generated questions and solutions must be fully standalone and must NOT reference textbook pages, chapters, passages, or excerpts. Do NOT treat the textbook content as a passage to be quoted or cited("According to the textbook...","According to the definition provided in the chapter...").
        - You are STRICTLY PROHIBITED from asking proof-based questions (e.g., "Prove that...", "Derive the formula for...", "Show that LHS = RHS").
        - Even if the provided PDF, New Concept, or key concepts contain proofs, theorems, or derivations, do NOT use them as the basis for a question.
        - You may use the *result* of a theorem/proof for application-based questions, but do not ask the student to reproduce the proof itself.
        - Dont give Hints or clues becasue this question is for examination
        **CRITICAL - Open-Ended Question Prohibition:**
            Do not create open-ended questions. An open-ended question is any question that requires more than one response, combines multiple tasks in the same item (such as calculate and then compare or decide), or produces multiple outputs in the answer key. Questions that ask students to perform a task and then make an additional decision or conclusion are also considered open-ended. Each question must ask only one thing and produce exactly one final answer only.
            or State the theoram,What can be concluded etc.. should not be asked.

      </what_not_to_do>
      
    </requirements>
     <output_format>
       Return JSON: 
      {
        "questions": [
          {
            "question_id": "Q1 (matching input)",
            "scenario_text/question_text": "The narrative story (no numbers).",
            "diagram_description": "Description of the visual setup with values.",
            "questions_list": [
              "Sub-question 1",
              "Sub-question 2..."
            ],
            "solution": "Solution for all sub-questions",
            "key_idea": "Key idea for all sub-questions"
          },
          ...
        ]
      }
    </output_format>
    </output_format>
  </writer_generation>
